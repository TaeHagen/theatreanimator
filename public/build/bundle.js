var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function i(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let o,a;function c(t,e){return o||(o=document.createElement("a")),o.href=e,t===o.href}function l(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function d(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function m(){return v(" ")}function y(){return v("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function w(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function g(t){return""===t?null:+t}function P(t,e){t.value=null==e?"":e}function k(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function x(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function _(t){a=t}function $(t){(function(){if(!a)throw new Error("Function called outside component initialization");return a})().$$.on_mount.push(t)}const S=[],C=[],T=[],E=[],O=Promise.resolve();let F=!1;function M(t){T.push(t)}const A=new Set;let L=0;function j(){const t=a;do{for(;L<S.length;){const t=S[L];L++,_(t),D(t.$$)}for(_(null),S.length=0,L=0;C.length;)C.pop()();for(let t=0;t<T.length;t+=1){const e=T[t];A.has(e)||(A.add(e),e())}T.length=0}while(S.length);for(;E.length;)E.pop()();F=!1,A.clear(),_(t)}function D(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const R=new Set;function z(t,e){t&&t.i&&(R.delete(t),t.i(e))}function N(t,n,s,o){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,s),o||M((()=>{const n=c.map(e).filter(i);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(M)}function I(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Y(t,e){-1===t.$$.dirty[0]&&(S.push(t),F||(F=!0,O.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function B(e,i,s,o,c,l,u,h=[-1]){const d=a;_(e);const f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:i.target||d.$$.root};u&&u(f.root);let v=!1;if(f.ctx=s?s(e,i.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return f.ctx&&c(f.ctx[t],f.ctx[t]=i)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](i),v&&Y(e,t)),n})):[],f.update(),v=!0,r(f.before_update),f.fragment=!!o&&o(f.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);f.fragment&&f.fragment.l(t),t.forEach(p)}else f.fragment&&f.fragment.c();i.intro&&z(e.$$.fragment),N(e,i.target,i.anchor,i.customElement),j()}_(d)}class U{$destroy(){I(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var X=function(t,e){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},X(t,e)};function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}X(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function K(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function J(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function V(t){return"function"==typeof t}function Z(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var G=Z((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function Q(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var W=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=K(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var c=this.initialTeardown;if(V(c))try{c()}catch(t){i=t instanceof G?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=K(l),h=u.next();!h.done;h=u.next()){var p=h.value;try{nt(p)}catch(t){i=null!=i?i:[],t instanceof G?i=J(J([],q(i)),q(t.errors)):i.push(t)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new G(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nt(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Q(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&Q(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),tt=W.EMPTY;function et(t){return t instanceof W||t&&"closed"in t&&V(t.remove)&&V(t.add)&&V(t.unsubscribe)}function nt(t){V(t)?t():t.unsubscribe()}var rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},it={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=it.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,J([t,e],q(n))):setTimeout.apply(void 0,J([t,e],q(n)))},clearTimeout:function(t){var e=it.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function st(){}var ot=null;function at(t){if(rt.useDeprecatedSynchronousErrorHandling){var e=!ot;if(e&&(ot={errorThrown:!1,error:null}),t(),e){var n=ot,r=n.errorThrown,i=n.error;if(ot=null,r)throw i}}else t()}var ct=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,et(e)&&e.add(n)):n.destination=ft,n}return H(e,t),e.create=function(t,e,n){return new pt(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(W),lt=Function.prototype.bind;function ut(t,e){return lt.call(t,e)}var ht=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){dt(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){dt(t)}else dt(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){dt(t)}},t}(),pt=function(t){function e(e,n,r){var i,s,o=t.call(this)||this;V(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&rt.useDeprecatedNextContext?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&ut(e.next,s),error:e.error&&ut(e.error,s),complete:e.complete&&ut(e.complete,s)}):i=e;return o.destination=new ht(i),o}return H(e,t),e}(ct);function dt(t){var e;e=t,it.setTimeout((function(){throw e}))}var ft={closed:!0,next:st,error:function(t){throw t},complete:st},vt="function"==typeof Symbol&&Symbol.observable||"@@observable";function mt(t){return t}function yt(t){return 0===t.length?mt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var bt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,i=this,s=(r=t)&&r instanceof ct||function(t){return t&&V(t.next)&&V(t.error)&&V(t.complete)}(r)&&et(r)?t:new pt(t,e,n);return at((function(){var t=i,e=t.operator,n=t.source;s.add(e?e.call(s,n):n?i._subscribe(s):i._trySubscribe(s))})),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=wt(e))((function(e,r){var i=new pt({next:function(e){try{t(e)}catch(t){r(t),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[vt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yt(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=wt(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function wt(t){var e;return null!==(e=null!=t?t:rt.Promise)&&void 0!==e?e:Promise}var gt=Z((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Pt=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return H(e,t),e.prototype.lift=function(t){var e=new kt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new gt},e.prototype.next=function(t){var e=this;at((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=K(e.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(t)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;at((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;at((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?tt:(this.currentObservers=null,s.push(t),new W((function(){e.currentObservers=null,Q(s,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},e.prototype.asObservable=function(){var t=new bt;return t.source=this,t},e.create=function(t,e){return new kt(t,e)},e}(bt),kt=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return H(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:tt},e}(Pt);class xt{constructor(){this.states=[],this.pointer=-1}pushState(t){this.pointer!==this.states.length-1&&this.states.splice(this.pointer+1),this.states.push(t),this.pointer++}undo(){this.pointer<0||(this.states[this.pointer].undo(),this.pointer--)}redo(){this.pointer+1!==this.states.length&&(this.states[this.pointer+1].redo(),this.pointer++)}}const _t={createPoint:(t,e,n,r)=>[t,e,n,r],parsePointX:t=>t[0],parsePointY:t=>t[1],parsePointTime:t=>t[2],parseBrushSize:t=>t[3],flatten:t=>({x:_t.parsePointX(t),y:_t.parsePointY(t),time:_t.parsePointTime(t),brushSize:_t.parseBrushSize(t)}),restore:t=>_t.createPoint(t.x,t.y,t.time,t.brushSize)};class $t{constructor(t){this.point=t,this.speed=500}flatten(){return{point:_t.flatten(this.point),speed:this.speed}}static restore(t){const e=new $t(_t.restore(t.point));return e.speed=t.speed,e}apply(t){t.effectivePointsPerSeconds=this.speed}}let St=0;class Ct{constructor(){this.id=St++,this.name="New Path",this.points=[],this.transaction=[],this.eraseTransaction=[],this.keyframes=[],this.pointsPerSecond=250,this.effectivePointsPerSeconds=this.pointsPerSecond,this.delay=0,this.lastPoint=null,this.newPoint$=new Pt,this.newKeyframe$=new Pt,this.changed$=new Pt}get clean(){return 0==this.points.length&&0==this.keyframes.length}findDist(t,e,n,r){return Math.sqrt(Math.abs(e-t)**2+Math.abs(r-n)**2)}applyKeyframesForPoint(t){this.effectivePointsPerSeconds=this.pointsPerSecond,this.keyframes.filter((e=>_t.parsePointTime(e.point)<=t)).map((t=>t.apply(this)))}flatten(){return{points:this.points.map((t=>_t.flatten(t))),keyframes:this.keyframes.map((t=>t.flatten())),pointsPerSecond:this.pointsPerSecond,name:this.name,id:this.id,delay:this.delay}}static restore(t){const e=new Ct;return e.points=t.points.map((t=>_t.restore(t))),e.keyframes=t.keyframes.map((t=>$t.restore(t))),e.pointsPerSecond=t.pointsPerSecond,e.name=t.name,e.id=t.id,e.delay=t.delay,e}findClosestPoint(t,e){if(0==this.points.length)return null;let n,r,i,s=this.points[0];const o=()=>{n=_t.parsePointX(s),r=_t.parsePointY(s),i=this.findDist(n,t,r,e)};o();for(const n of this.points){const r=_t.parsePointX(n),a=_t.parsePointY(n);this.findDist(r,t,a,e)<i&&(s=n,o())}return s}addPoint(t,e,n){if(this.lastPoint=this.findClosestPoint(t,e),null!=this.lastPoint){const n=_t.parsePointX(this.lastPoint),r=_t.parsePointY(this.lastPoint);if(n==t&&r==e)return}const r=_t.createPoint(t,e,null!=this.lastPoint?_t.parsePointTime(this.lastPoint)+1:0,n);this.points.push(r),this.transaction.push(r),this.lastPoint=r,this.newPoint$.next(r)}eraseRadius(t,e,n){this.points=this.points.filter((r=>{const i=this.findDist(t,_t.parsePointX(r),e,_t.parsePointY(r))>n;return i||this.eraseTransaction.push(r),i})),this.changed$.next()}addKeyframe(t,e,n){var r;const i=new $t(_t.createPoint(t,e,null!==(r=_t.parsePointTime(this.findClosestPoint(t,e))+1)&&void 0!==r?r:0,n));this.keyframes.push(i),this.newKeyframe$.next(i)}finishTransaction(){const t=this.transaction,e=this.eraseTransaction;return this.transaction=[],this.eraseTransaction=[],{name:"Add stroke",undo:()=>{this.points=this.points.filter((e=>!t.includes(e))).concat(e),this.changed$.next()},redo:()=>{this.points=this.points.concat(t).filter((t=>!e.includes(t))),this.changed$.next()}}}strokeDone(){this.lastPoint=null}}class Tt{constructor(){this.paths=[new Ct],this.backgroundColor="#FFFFFF"}addPath(){const t=new Ct;return this.paths.push(t),t}flatten(){return{paths:this.paths.map((t=>t.flatten())),backgroundColor:this.backgroundColor}}get clean(){return this.paths.every((t=>t.clean))}static restore(t){const e=new Tt;return e.paths=t.paths.map((t=>Ct.restore(t))),e.backgroundColor=t.backgroundColor,e}}class Et{constructor(t){this.canvas=t,this.totalPoints=0,this.pathProgress=new Map,this.pathPoints=new Map,this.secSinceStart=0,this.ctx=t.getContext("2d")}allDrawn(){for(const t of this.pathPoints.values())if(t.length>0)return!1;return!0}drawNextFrame(t){this.secSinceStart+=t;const e=this.pointsForPaths(t);if(this.allDrawn())return!1;for(const t of e){this.ctx.save(),this.ctx.beginPath();for(const e of t)this.drawPoint(e);this.ctx.clip(),this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.image,0,0),this.ctx.restore()}return!0}pointsForPaths(t){return this.painting.paths.map((e=>{var n,r;if(this.secSinceStart<e.delay/1e3)return null;let i=null!==(n=this.pathProgress.get(e))&&void 0!==n?n:0;i+=t*e.effectivePointsPerSeconds,this.pathProgress.set(e,i),e.applyKeyframesForPoint(i);let s=null!==(r=this.pathPoints.get(e))&&void 0!==r?r:e.points,o=[];return s=s.filter((t=>{const e=_t.parsePointTime(t)<=i;return e&&o.push(t),!e})),this.pathPoints.set(e,s),o})).filter((t=>null!=t))}prepare(){this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.totalPoints=this.painting.paths.reduce(((t,e)=>t+e.points.length),0),this.pathProgress.clear(),this.secSinceStart=0,this.pathProgress.clear();for(const t of this.painting.paths)this.pathPoints.set(t,t.points)}drawPoint(t){this.ctx.arc(_t.parsePointX(t),_t.parsePointY(t),_t.parseBrushSize(t),0,2*Math.PI)}}class Ot{constructor(t){this.canvas=t,this.currentPathSubscriptions=[],this.ctx=t.getContext("2d")}set currentPath(t){this._currentPath=t,this.currentPathSubscriptions.forEach((t=>t.unsubscribe())),this.redrawPath(),null!=t&&(this.currentPathSubscriptions.push(t.newPoint$.subscribe((t=>this.drawPoint(t)))),this.currentPathSubscriptions.push(t.changed$.subscribe((()=>this.redrawPath()))))}get currentPath(){return this._currentPath}redrawPath(){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),null!=this.currentPath)for(const t of this.currentPath.points)this.drawPoint(t)}drawPoint(t){const e=function(t,e,n){var r,i,s,o,a,c,l,u;switch(1===arguments.length&&(e=t.s,n=t.v,t=t.h),c=n*(1-e),l=n*(1-(a=6*t-(o=Math.floor(6*t)))*e),u=n*(1-(1-a)*e),o%6){case 0:r=n,i=u,s=c;break;case 1:r=l,i=n,s=c;break;case 2:r=c,i=n,s=u;break;case 3:r=c,i=l,s=n;break;case 4:r=u,i=c,s=n;break;case 5:r=n,i=c,s=l}return{r:Math.round(255*r),g:Math.round(255*i),b:Math.round(255*s)}}(_t.parsePointTime(t)/1e3,1,1);this.ctx.fillStyle=`rgba(${e.r}, ${e.g}, ${e.b}, 255)`,this.ctx.beginPath(),this.ctx.arc(_t.parsePointX(t),_t.parsePointY(t),_t.parseBrushSize(t),0,2*Math.PI,!1),this.ctx.fill()}}function Ft(t,e,n){const r=t.slice();return r[4]=e[n],r}function Mt(t){let e,n=t[0].keyframes,r=[];for(let e=0;e<n.length;e+=1)r[e]=At(Ft(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=y()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);h(t,e,n)},p(t,i){if(3&i){let s;for(n=t[0].keyframes,s=0;s<n.length;s+=1){const o=Ft(t,n,s);r[s]?r[s].p(o,i):(r[s]=At(o),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){d(r,t),t&&p(e)}}}function At(t){let e,n,r;function i(){return t[3](t[4])}return{c(){e=f("span"),w(e,"class","keyframe svelte-cpouo2"),k(e,"top",_t.parsePointY(t[4].point)-5+"px"),k(e,"left",_t.parsePointX(t[4].point)-5+"px")},m(t,s){h(t,e,s),n||(r=b(e,"click",i),n=!0)},p(n,r){t=n,1&r&&k(e,"top",_t.parsePointY(t[4].point)-5+"px"),1&r&&k(e,"left",_t.parsePointX(t[4].point)-5+"px")},d(t){t&&p(e),n=!1,r()}}}function Lt(e){let n,r=null!=e[0]&&Mt(e);return{c(){r&&r.c(),n=y()},m(t,e){r&&r.m(t,e),h(t,n,e)},p(t,[e]){null!=t[0]?r?r.p(t,e):(r=Mt(t),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:t,o:t,d(t){r&&r.d(t),t&&p(n)}}}function jt(t,e,n){let{path:r}=e,i=[];const s=t=>{t.speed=parseInt(prompt("New speed",t.speed.toString()))};return t.$$set=t=>{"path"in t&&n(0,r=t.path)},t.$$.update=()=>{5&t.$$.dirty&&(i.forEach((t=>t.unsubscribe())),n(2,i=[]),null!=r&&(i.push(r.newKeyframe$.subscribe((t=>{n(0,r),n(2,i),s(t)}))),i.push(r.changed$.subscribe((t=>{n(0,r),n(2,i)})))))},[r,s,i,t=>{s(t)}]}class Dt extends U{constructor(t){super(),B(this,t,jt,Lt,s,{path:0})}}function Rt(t,e){return new Promise((n=>t.addEventListener(e,n,{once:!0})))}class zt{constructor(t,e=30){this.FPS=e,this.source=t;const n=this.canvas=t.cloneNode();(this.drawingContext=n.getContext("2d")).drawImage(t,0,0);const r=this.stream=n.captureStream(0),i=this.track=r.getVideoTracks()[0];i.requestFrame||(i.requestFrame=()=>r.requestFrame());const s=this.recorder=new MediaRecorder(r,{bitsPerSecond:25e6}),o=this.chunks=[];s.ondataavailable=t=>o.push(t.data),s.start(),Rt(s,"start").then((t=>s.pause())),this._init=Rt(s,"pause")}async recordFrame(){await this._init;const t=this.recorder,e=this.canvas,n=this.source,r=this.drawingContext;e.width===n.width&&e.height===n.height||(e.width=n.width,e.height=n.height);const i=(s=1e3/this.FPS,new Promise((t=>setTimeout(t,s))));var s;t.resume(),await Rt(t,"resume"),r.clearRect(0,0,e.width,e.height),r.drawImage(n,0,0),this.track.requestFrame(),await i,t.pause(),await Rt(t,"pause")}async export(){return this.recorder.stop(),this.stream.getTracks().forEach((t=>t.stop())),await Rt(this.recorder,"stop"),new Blob(this.chunks,{type:"video/mp4"})}}function Nt(t,e,n){const r=t.slice();return r[48]=e[n],r}function It(e){let n,r,i;return{c(){n=f("button"),n.innerHTML='<span class="material-icons">stop</span>',w(n,"class","svelte-4kww0")},m(t,s){h(t,n,s),r||(i=b(n,"click",e[22]),r=!0)},p:t,d(t){t&&p(n),r=!1,i()}}}function Yt(e){let n,r,i;return{c(){n=f("button"),n.innerHTML='<span class="material-icons">play_arrow</span>',w(n,"class","svelte-4kww0")},m(t,s){h(t,n,s),r||(i=b(n,"click",e[21]),r=!0)},p:t,d(t){t&&p(n),r=!1,i()}}}function Bt(t){let e,n,r,i,s=t[48].name+"";return{c(){e=f("option"),n=v(s),r=m(),e.__value=i=t[48].id,e.value=e.__value},m(t,i){h(t,e,i),u(e,n),u(e,r)},p(t,r){1&r[0]&&s!==(s=t[48].name+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,s),1&r[0]&&i!==(i=t[48].id)&&(e.__value=i,e.value=e.__value)},d(t){t&&p(e)}}}function Ut(t){let e,n,i,s,o,a,c,l,u,d,v,y,x,_,$,S;return{c(){e=f("span"),e.textContent="Path name",n=m(),i=f("input"),s=m(),o=f("span"),o.textContent="Speed",a=m(),c=f("input"),l=m(),u=f("span"),u.textContent="Start delay (ms)",d=m(),v=f("input"),y=f("br"),x=m(),_=f("button"),_.textContent="Delete path",w(e,"class","miniheader svelte-4kww0"),w(i,"type","text"),w(i,"class","svelte-4kww0"),w(o,"class","miniheader svelte-4kww0"),w(c,"type","range"),w(c,"min","1"),w(c,"max","1500"),w(c,"class","svelte-4kww0"),w(u,"class","miniheader svelte-4kww0"),w(v,"type","number"),w(v,"class","svelte-4kww0"),k(_,"background-color","#e53e3e"),k(_,"margin-top","15px"),w(_,"class","svelte-4kww0")},m(r,p){h(r,e,p),h(r,n,p),h(r,i,p),P(i,t[2].name),h(r,s,p),h(r,o,p),h(r,a,p),h(r,c,p),P(c,t[2].pointsPerSecond),h(r,l,p),h(r,u,p),h(r,d,p),h(r,v,p),P(v,t[2].delay),h(r,y,p),h(r,x,p),h(r,_,p),$||(S=[b(i,"input",t[31]),b(i,"change",t[32]),b(c,"change",t[33]),b(c,"input",t[33]),b(v,"input",t[34]),b(_,"click",t[35])],$=!0)},p(t,e){5&e[0]&&i.value!==t[2].name&&P(i,t[2].name),5&e[0]&&P(c,t[2].pointsPerSecond),5&e[0]&&g(v.value)!==t[2].delay&&P(v,t[2].delay)},d(t){t&&p(e),t&&p(n),t&&p(i),t&&p(s),t&&p(o),t&&p(a),t&&p(c),t&&p(l),t&&p(u),t&&p(d),t&&p(v),t&&p(y),t&&p(x),t&&p(_),$=!1,r(S)}}}function Xt(t){let e,n,i,s,o,a,v,y,g,_,$,S,C,T,E,O,F,M,A,L,j,D,Y,B,U,X,H,K,q,J,V,Z,G,Q,W,tt,et,nt,rt,it,st,ot,at,ct,lt,ut,ht,pt,dt,ft,vt,mt,yt,bt,wt;function gt(t,e){return-1==t[10]?Yt:It}let Pt=gt(t),kt=Pt(t),xt=t[0].paths,_t=[];for(let e=0;e<xt.length;e+=1)_t[e]=Bt(Nt(t,xt,e));let $t=null!=t[2]&&Ut(t);return dt=new Dt({props:{path:t[2]}}),{c(){e=f("main"),n=f("div"),i=f("div"),s=f("input"),o=m(),a=f("div"),kt.c(),v=m(),y=f("button"),y.innerHTML='<span class="material-icons">image</span>',g=m(),_=f("button"),_.innerHTML='<span class="material-icons">download</span>',$=m(),S=f("button"),S.innerHTML='<span class="material-icons">upload</span>',C=m(),T=f("button"),T.innerHTML='<span class="material-icons">layers_clear</span>',E=m(),O=f("button"),F=f("span"),F.textContent="brush",A=m(),L=f("button"),j=f("span"),j.textContent="clear",Y=m(),B=f("button"),B.innerHTML='<span class="material-icons">movie</span>',U=m(),X=f("div"),H=f("select");for(let t=0;t<_t.length;t+=1)_t[t].c();var r;K=f("option"),q=f("option"),q.textContent="Add Path",V=m(),$t&&$t.c(),Z=m(),G=f("div"),Q=f("span"),Q.textContent="Brush size",W=m(),tt=f("input"),et=m(),nt=f("span"),nt.textContent="Background color",rt=m(),it=f("input"),st=m(),ot=f("div"),at=f("div"),ct=f("img"),ut=m(),ht=f("canvas"),pt=m(),(r=dt.$$.fragment)&&r.c(),ft=m(),vt=f("div"),mt=f("canvas"),w(s,"type","text"),w(s,"placeholder","Project Name"),w(s,"class","svelte-4kww0"),w(y,"title","Open image"),w(y,"class","svelte-4kww0"),w(_,"class","svelte-4kww0"),w(S,"class","svelte-4kww0"),w(T,"title","Clear all layers"),w(T,"class","svelte-4kww0"),w(F,"class","material-icons"),w(O,"class",M=l(t[13]?"":"selected")+" svelte-4kww0"),w(j,"class","material-icons"),w(L,"title","Erase"),w(L,"class",D=l(t[13]?"selected":"")+" svelte-4kww0"),w(B,"title","Render"),w(B,"class","svelte-4kww0"),w(a,"class","topbar svelte-4kww0"),K.__value=-1,K.value=K.__value,q.__value=-2,q.value=q.__value,w(H,"class","svelte-4kww0"),k(X,"text-align","right"),w(i,"class","sidebartop svelte-4kww0"),w(Q,"class","miniheader svelte-4kww0"),w(tt,"type","range"),w(tt,"min","1"),w(tt,"max","20"),w(tt,"class","svelte-4kww0"),w(nt,"class","miniheader svelte-4kww0"),w(it,"type","color"),w(it,"class","svelte-4kww0"),w(G,"class","footer"),w(n,"class","sidebar svelte-4kww0"),c(ct.src,lt=t[4])||w(ct,"src",lt),k(ct,"background-color",t[0].backgroundColor),w(ht,"width",t[8]),w(ht,"height",t[9]),w(ht,"class","svelte-4kww0"),w(at,"class","overlay image svelte-4kww0"),k(at,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[12]}" viewBox="0 0 ${2*t[12]} ${2*t[12]}" width="${2*t[12]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[12]}" cy="${t[12]}" r="${t[12]}"/></svg>') ${t[12]} ${t[12]}, auto`),w(mt,"width",t[8]),w(mt,"height",t[9]),k(mt,"background-color",t[0].backgroundColor),w(vt,"class","image svelte-4kww0"),w(ot,"class","imagesContainer svelte-4kww0"),w(e,"class","svelte-4kww0")},m(r,c){h(r,e,c),u(e,n),u(n,i),u(i,s),P(s,t[14]),u(i,o),u(i,a),kt.m(a,null),u(a,v),u(a,y),u(a,g),u(a,_),u(a,$),u(a,S),u(a,C),u(a,T),u(a,E),u(a,O),u(O,F),u(a,A),u(a,L),u(L,j),u(a,Y),u(a,B),u(i,U),u(i,X),u(X,H);for(let t=0;t<_t.length;t+=1)_t[t].m(H,null);u(H,K),u(H,q),x(H,t[2]?.id??-1),u(i,V),$t&&$t.m(i,null),u(n,Z),u(n,G),u(G,Q),u(G,W),u(G,tt),P(tt,t[12]),u(G,et),u(G,nt),u(G,rt),u(G,it),P(it,t[0].backgroundColor),u(e,st),u(e,ot),u(ot,at),u(at,ct),t[38](ct),u(at,ut),u(at,ht),t[40](ht),u(at,pt),N(dt,at,null),u(ot,ft),u(ot,vt),u(vt,mt),t[42](mt),yt=!0,bt||(wt=[b(s,"input",t[20]),b(y,"click",t[23]),b(_,"click",t[24]),b(S,"click",t[25]),b(T,"click",t[26]),b(O,"click",t[27]),b(L,"click",t[28]),b(B,"click",t[29]),b(H,"change",t[30]),b(tt,"change",t[36]),b(tt,"input",t[36]),b(it,"input",t[37]),b(ct,"load",t[39]),b(ht,"mousemove",t[18]),b(ht,"wheel",t[41])],bt=!0)},p(t,e){if(16384&e[0]&&s.value!==t[14]&&P(s,t[14]),Pt===(Pt=gt(t))&&kt?kt.p(t,e):(kt.d(1),kt=Pt(t),kt&&(kt.c(),kt.m(a,v))),(!yt||8192&e[0]&&M!==(M=l(t[13]?"":"selected")+" svelte-4kww0"))&&w(O,"class",M),(!yt||8192&e[0]&&D!==(D=l(t[13]?"selected":"")+" svelte-4kww0"))&&w(L,"class",D),1&e[0]){let n;for(xt=t[0].paths,n=0;n<xt.length;n+=1){const r=Nt(t,xt,n);_t[n]?_t[n].p(r,e):(_t[n]=Bt(r),_t[n].c(),_t[n].m(H,K))}for(;n<_t.length;n+=1)_t[n].d(1);_t.length=xt.length}(!yt||5&e[0]&&J!==(J=t[2]?.id??-1))&&x(H,t[2]?.id??-1),null!=t[2]?$t?$t.p(t,e):($t=Ut(t),$t.c(),$t.m(i,null)):$t&&($t.d(1),$t=null),4096&e[0]&&P(tt,t[12]),1&e[0]&&P(it,t[0].backgroundColor),(!yt||16&e[0]&&!c(ct.src,lt=t[4]))&&w(ct,"src",lt),(!yt||1&e[0])&&k(ct,"background-color",t[0].backgroundColor),(!yt||256&e[0])&&w(ht,"width",t[8]),(!yt||512&e[0])&&w(ht,"height",t[9]);const n={};4&e[0]&&(n.path=t[2]),dt.$set(n),(!yt||4096&e[0])&&k(at,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[12]}" viewBox="0 0 ${2*t[12]} ${2*t[12]}" width="${2*t[12]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[12]}" cy="${t[12]}" r="${t[12]}"/></svg>') ${t[12]} ${t[12]}, auto`),(!yt||256&e[0])&&w(mt,"width",t[8]),(!yt||512&e[0])&&w(mt,"height",t[9]),(!yt||1&e[0])&&k(mt,"background-color",t[0].backgroundColor)},i(t){yt||(z(dt.$$.fragment,t),yt=!0)},o(t){!function(t,e,n,r){if(t&&t.o){if(R.has(t))return;R.add(t),(void 0).c.push((()=>{R.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}(dt.$$.fragment,t),yt=!1},d(n){n&&p(e),kt.d(),d(_t,n),$t&&$t.d(),t[38](null),t[40](null),I(dt),t[42](null),bt=!1,r(wt)}}}function Ht(t,e,n){let r,i,s,o,a,c,l,u,h=null,p=null,d=0,f=0,v=new Tt,m=new xt;const y=()=>{v.paths.length>0&&n(2,c=v.paths[0])};y();let b=-1,w=-1,P=10,k=!1,x="";const _=()=>""!=x?x:"Animation";let S=(T=document.createElement("a"),document.body.appendChild(T),T.style.display="none",function(t,e){let n=window.URL.createObjectURL(t);T.href=n,T.download=e,T.click(),window.URL.revokeObjectURL(n)});var T;$((async()=>{n(19,o=new Ot(r)),n(1,a=new Et(i)),n(1,a.image=s,a)}));let E=0,O=0;document.onkeydown=t=>{if(t.target===document.body&&t.ctrlKey)switch(t.key){case"z":m.undo(),t.preventDefault();break;case"Z":case"y":m.redo(),t.preventDefault();break;case"k":if(null==c)return;c.addKeyframe(E,O,P),t.preventDefault();break;case"p":n(2,c=v.addPath()),n(0,v),t.preventDefault()}};return t.$$.update=()=>{3&t.$$.dirty[0]&&null!=a&&n(1,a.painting=v,a),524292&t.$$.dirty[0]&&null!=o&&n(19,o.currentPath=c,o),24&t.$$.dirty[0]&&(null!=u&&(URL.revokeObjectURL(u),n(4,u=null)),null!=l&&n(4,u=URL.createObjectURL(l)))},[v,a,c,l,u,r,i,s,d,f,b,w,P,k,x,y,_,S,t=>{if(null==c)return;let e=r.getBoundingClientRect();E=t.clientX-e.left,O=t.clientY-e.top,0!=t.buttons?(null!=h&&function(t,e,n,r,i){for(var s=Math.abs(t-n),o=Math.abs(e-r),a=n<t?1:-1,c=r<e?1:-1,l=s-o;i(n,r),!(Math.abs(n-t)<1e-4&&Math.abs(r-e)<1e-4);){var u=2*l;u>-o&&(l-=o,n+=a),u<s&&(l+=s,r+=c)}}(h,p,E,O,((t,e)=>k?c.eraseRadius(t,e,P):c.addPoint(t,e,P))),h=E,p=O):(null!=h&&m.pushState(c.finishTransaction()),c.strokeDone(),h=null)},o,function(){x=this.value,n(14,x)},()=>{a.prepare(),n(11,w=-1);const t=()=>n(10,b=window.requestAnimationFrame((e=>{-1!=w?a.drawNextFrame((e-w)/1e3)?t():n(10,b=-1):(n(11,w=e),t()),n(11,w=e)})));t()},()=>{window.cancelAnimationFrame(b),n(10,b=-1)},()=>{!function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{t(e.files[0])}))}((t=>{!v.clean&&confirm("Are you sure you have saved?")&&(n(0,v=new Tt),y()),n(3,l=t)}))},()=>{var t=JSON.stringify(v.flatten()),e=new Blob([t],{type:"octet/stream"});S(e,_())},()=>{(v.clean||confirm("Are you sure you have saved?"))&&function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{var n=new FileReader;n.onload=function(){document.body.removeChild(e),t(JSON.parse(n.result.toString()),e.files[0].name)},n.readAsText(e.files[0])}))}(((t,e)=>{n(0,v=Tt.restore(t)),n(14,x=e),y()}))},()=>{confirm("Are you sure you have saved?")&&(n(0,v=new Tt),y())},()=>{n(13,k=!1)},()=>{n(13,k=!0)},async()=>{const t=new zt(i,60);for(a.prepare();a.drawNextFrame(1/60);)await t.recordFrame();const e=await t.export();S(e,`${_()}.webm`)},t=>{const e=t.currentTarget.value;n(2,c="-1"==e?null:"-2"==e?v.addPath():v.paths.find((t=>t.id==parseInt(e)))),n(0,v)},function(){c.name=this.value,n(2,c),n(0,v)},()=>n(0,v),function(){c.pointsPerSecond=g(this.value),n(2,c),n(0,v)},function(){c.delay=g(this.value),n(2,c),n(0,v)},()=>{v.paths.splice(v.paths.indexOf(c),1),n(2,c=null),n(0,v)},function(){P=g(this.value),n(12,P)},function(){v.backgroundColor=this.value,n(0,v)},function(t){C[t?"unshift":"push"]((()=>{s=t,n(7,s)}))},()=>{n(8,d=s.width),n(9,f=s.height)},function(t){C[t?"unshift":"push"]((()=>{r=t,n(5,r)}))},t=>{n(12,P+=t.deltaY>0?-1:1),t.preventDefault()},function(t){C[t?"unshift":"push"]((()=>{i=t,n(6,i)}))}]}return new class extends U{constructor(t){super(),B(this,t,Ht,Xt,s,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
