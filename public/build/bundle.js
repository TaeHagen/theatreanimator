var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let s,a;function c(t,e){return s||(s=document.createElement("a")),s.href=e,t===s.href}function l(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function d(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function m(){return v(" ")}function y(){return v("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t){return""===t?null:+t}function k(t,e){t.value=null==e?"":e}function P(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function x(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function _(t){a=t}function $(t){(function(){if(!a)throw new Error("Function called outside component initialization");return a})().$$.on_mount.push(t)}const S=[],j=[],C=[],T=[],E=Promise.resolve();let O=!1;function F(t){C.push(t)}const M=new Set;let A=0;function L(){const t=a;do{for(;A<S.length;){const t=S[A];A++,_(t),D(t.$$)}for(_(null),S.length=0,A=0;j.length;)j.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];M.has(e)||(M.add(e),e())}C.length=0}while(S.length);for(;T.length;)T.pop()();O=!1,M.clear(),_(t)}function D(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(F)}}const R=new Set;function z(t,e){t&&t.i&&(R.delete(t),t.i(e))}function N(t,n,i,s){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,i),s||F((()=>{const n=c.map(e).filter(o);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(F)}function I(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Y(t,e){-1===t.$$.dirty[0]&&(S.push(t),O||(O=!0,E.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function B(e,o,i,s,c,l,u,h=[-1]){const d=a;_(e);const f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(d?d.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:o.target||d.$$.root};u&&u(f.root);let v=!1;if(f.ctx=i?i(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return f.ctx&&c(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),v&&Y(e,t)),n})):[],f.update(),v=!0,r(f.before_update),f.fragment=!!s&&s(f.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);f.fragment&&f.fragment.l(t),t.forEach(p)}else f.fragment&&f.fragment.c();o.intro&&z(e.$$.fragment),N(e,o.target,o.anchor,o.customElement),L()}_(d)}class U{$destroy(){I(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var X=function(t,e){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},X(t,e)};function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}X(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function K(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function J(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}function V(t){return"function"==typeof t}function Z(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var G=Z((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function Q(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var W=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=K(i),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else i.remove(this);var c=this.initialTeardown;if(V(c))try{c()}catch(t){o=t instanceof G?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=K(l),h=u.next();!h.done;h=u.next()){var p=h.value;try{nt(p)}catch(t){o=null!=o?o:[],t instanceof G?o=J(J([],q(o)),q(t.errors)):o.push(t)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(o)throw new G(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nt(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Q(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&Q(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),tt=W.EMPTY;function et(t){return t instanceof W||t&&"closed"in t&&V(t.remove)&&V(t.add)&&V(t.unsubscribe)}function nt(t){V(t)?t():t.unsubscribe()}var rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ot={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=ot.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,J([t,e],q(n))):setTimeout.apply(void 0,J([t,e],q(n)))},clearTimeout:function(t){var e=ot.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function it(){}var st=null;function at(t){if(rt.useDeprecatedSynchronousErrorHandling){var e=!st;if(e&&(st={errorThrown:!1,error:null}),t(),e){var n=st,r=n.errorThrown,o=n.error;if(st=null,r)throw o}}else t()}var ct=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,et(e)&&e.add(n)):n.destination=ft,n}return H(e,t),e.create=function(t,e,n){return new pt(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(W),lt=Function.prototype.bind;function ut(t,e){return lt.call(t,e)}var ht=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){dt(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){dt(t)}else dt(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){dt(t)}},t}(),pt=function(t){function e(e,n,r){var o,i,s=t.call(this)||this;V(e)||!e?o={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&rt.useDeprecatedNextContext?((i=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},o={next:e.next&&ut(e.next,i),error:e.error&&ut(e.error,i),complete:e.complete&&ut(e.complete,i)}):o=e;return s.destination=new ht(o),s}return H(e,t),e}(ct);function dt(t){var e;e=t,ot.setTimeout((function(){throw e}))}var ft={closed:!0,next:it,error:function(t){throw t},complete:it},vt="function"==typeof Symbol&&Symbol.observable||"@@observable";function mt(t){return t}function yt(t){return 0===t.length?mt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var bt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,o=this,i=(r=t)&&r instanceof ct||function(t){return t&&V(t.next)&&V(t.error)&&V(t.complete)}(r)&&et(r)?t:new pt(t,e,n);return at((function(){var t=o,e=t.operator,n=t.source;i.add(e?e.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=gt(e))((function(e,r){var o=new pt({next:function(e){try{t(e)}catch(t){r(t),o.unsubscribe()}},error:r,complete:e});n.subscribe(o)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[vt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yt(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=gt(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function gt(t){var e;return null!==(e=null!=t?t:rt.Promise)&&void 0!==e?e:Promise}var wt=Z((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),kt=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return H(e,t),e.prototype.lift=function(t){var e=new Pt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new wt},e.prototype.next=function(t){var e=this;at((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var o=K(e.currentObservers),i=o.next();!i.done;i=o.next()){i.value.next(t)}}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;at((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;at((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?tt:(this.currentObservers=null,i.push(t),new W((function(){e.currentObservers=null,Q(i,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,o=e.isStopped;n?t.error(r):o&&t.complete()},e.prototype.asObservable=function(){var t=new bt;return t.source=this,t},e.create=function(t,e){return new Pt(t,e)},e}(bt),Pt=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return H(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:tt},e}(kt);class xt{constructor(){this.states=[],this.pointer=-1}pushState(t){this.pointer!==this.states.length-1&&this.states.splice(this.pointer+1),this.states.push(t),this.pointer++}undo(){this.pointer<0||(this.states[this.pointer].undo(),this.pointer--)}redo(){this.pointer+1!==this.states.length&&(this.states[this.pointer+1].redo(),this.pointer++)}}const _t={createPoint:(t,e,n,r)=>[t,e,n,r],parsePointX:t=>t[0],parsePointY:t=>t[1],parsePointTime:t=>t[2],parseBrushSize:t=>t[3],flatten:t=>({x:_t.parsePointX(t),y:_t.parsePointY(t),time:_t.parsePointTime(t),brushSize:_t.parseBrushSize(t)}),restore:t=>_t.createPoint(t.x,t.y,t.time,t.brushSize)};class $t{constructor(t){this.point=t,this.speed=500}flatten(){return{point:_t.flatten(this.point),speed:this.speed}}static restore(t){const e=new $t(_t.restore(t.point));return e.speed=t.speed,e}apply(t){t.effectivePointsPerSeconds=this.speed}}let St=0;class jt{constructor(){this.id=St++,this.name="New Path",this.points=[],this.transaction=[],this.eraseTransaction=[],this.keyframes=[],this.pointsPerSecond=250,this.effectivePointsPerSeconds=this.pointsPerSecond,this.delay=0,this.lastPoint=null,this.newPoint$=new kt,this.newKeyframe$=new kt,this.changed$=new kt}get clean(){return 0==this.points.length&&0==this.keyframes.length}findDist(t,e,n,r){return Math.sqrt(Math.abs(e-t)**2+Math.abs(r-n)**2)}applyKeyframesForPoint(t){this.effectivePointsPerSeconds=this.pointsPerSecond,this.keyframes.filter((e=>_t.parsePointTime(e.point)<=t)).map((t=>t.apply(this)))}flatten(){return{points:this.points.map((t=>_t.flatten(t))),keyframes:this.keyframes.map((t=>t.flatten())),pointsPerSecond:this.pointsPerSecond,name:this.name,id:this.id,delay:this.delay}}static restore(t){const e=new jt;return e.points=t.points.map((t=>_t.restore(t))),e.keyframes=t.keyframes.map((t=>$t.restore(t))),e.pointsPerSecond=t.pointsPerSecond,e.name=t.name,e.id=t.id,e.delay=t.delay,e}findClosestPoint(t,e){if(0==this.points.length)return null;let n,r,o,i=this.points[0];const s=()=>{n=_t.parsePointX(i),r=_t.parsePointY(i),o=this.findDist(n,t,r,e)};s();for(const n of this.points){const r=_t.parsePointX(n),a=_t.parsePointY(n);this.findDist(r,t,a,e)<o&&(i=n,s())}return i}addPoint(t,e,n){if(this.lastPoint=this.findClosestPoint(t,e),null!=this.lastPoint){const n=_t.parsePointX(this.lastPoint),r=_t.parsePointY(this.lastPoint);if(n==t&&r==e)return}const r=_t.createPoint(t,e,null!=this.lastPoint?_t.parsePointTime(this.lastPoint)+1:0,n);this.points.push(r),this.transaction.push(r),this.lastPoint=r,this.newPoint$.next(r)}eraseRadius(t,e,n){this.points=this.points.filter((r=>{const o=this.findDist(t,_t.parsePointX(r),e,_t.parsePointY(r))>n;return o||this.eraseTransaction.push(r),o})),this.changed$.next()}addKeyframe(t,e,n){var r;const o=new $t(_t.createPoint(t,e,null!==(r=_t.parsePointTime(this.findClosestPoint(t,e))+1)&&void 0!==r?r:0,n));this.keyframes.push(o),this.newKeyframe$.next(o)}finishTransaction(){const t=this.transaction,e=this.eraseTransaction;return this.transaction=[],this.eraseTransaction=[],{name:"Add stroke",undo:()=>{this.points=this.points.filter((e=>!t.includes(e))).concat(e),this.changed$.next()},redo:()=>{this.points=this.points.concat(t).filter((t=>!e.includes(t))),this.changed$.next()}}}strokeDone(){this.lastPoint=null}}class Ct{constructor(){this.paths=[new jt],this.backgroundColor="#FFFFFF"}addPath(){const t=new jt;return this.paths.push(t),t}flatten(){return{paths:this.paths.map((t=>t.flatten())),backgroundColor:this.backgroundColor}}get clean(){return this.paths.every((t=>t.clean))}static restore(t){const e=new Ct;return e.paths=t.paths.map((t=>jt.restore(t))),e.backgroundColor=t.backgroundColor,e}}class Tt{constructor(t){this.canvas=t,this.totalPoints=0,this.pathProgress=new Map,this.pathPoints=new Map,this.secSinceStart=0,this.ctx=t.getContext("2d")}allDrawn(){for(const t of this.pathPoints.values())if(t.length>0)return!1;return!0}drawNextFrame(t){this.secSinceStart+=t;const e=this.pointsForPaths(t);if(this.allDrawn())return!1;for(const t of e){this.ctx.save(),this.ctx.beginPath();for(const e of t)this.drawPoint(e);this.ctx.clip(),this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.image,0,0),this.ctx.restore()}return!0}pointsForPaths(t){return this.painting.paths.map((e=>{var n,r;if(this.secSinceStart<e.delay/1e3)return null;let o=null!==(n=this.pathProgress.get(e))&&void 0!==n?n:0;o+=t*e.effectivePointsPerSeconds,this.pathProgress.set(e,o),e.applyKeyframesForPoint(o);let i=null!==(r=this.pathPoints.get(e))&&void 0!==r?r:e.points,s=[];return i=i.filter((t=>{const e=_t.parsePointTime(t)<=o;return e&&s.push(t),!e})),this.pathPoints.set(e,i),s})).filter((t=>null!=t))}prepare(){this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.totalPoints=this.painting.paths.reduce(((t,e)=>t+e.points.length),0),this.pathProgress.clear(),this.secSinceStart=0,this.pathProgress.clear();for(const t of this.painting.paths)this.pathPoints.set(t,t.points)}drawPoint(t){this.ctx.arc(_t.parsePointX(t),_t.parsePointY(t),_t.parseBrushSize(t),0,2*Math.PI)}}class Et{constructor(t){this.canvas=t,this.currentPathSubscriptions=[],this.ctx=t.getContext("2d")}set currentPath(t){this._currentPath=t,this.currentPathSubscriptions.forEach((t=>t.unsubscribe())),this.redrawPath(),null!=t&&(this.currentPathSubscriptions.push(t.newPoint$.subscribe((t=>this.drawPoint(t)))),this.currentPathSubscriptions.push(t.changed$.subscribe((()=>this.redrawPath()))))}get currentPath(){return this._currentPath}redrawPath(){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),null!=this.currentPath)for(const t of this.currentPath.points)this.drawPoint(t)}drawPoint(t){const e=function(t,e,n){var r,o,i,s,a,c,l,u;switch(1===arguments.length&&(e=t.s,n=t.v,t=t.h),c=n*(1-e),l=n*(1-(a=6*t-(s=Math.floor(6*t)))*e),u=n*(1-(1-a)*e),s%6){case 0:r=n,o=u,i=c;break;case 1:r=l,o=n,i=c;break;case 2:r=c,o=n,i=u;break;case 3:r=c,o=l,i=n;break;case 4:r=u,o=c,i=n;break;case 5:r=n,o=c,i=l}return{r:Math.round(255*r),g:Math.round(255*o),b:Math.round(255*i)}}(_t.parsePointTime(t)/1e3,1,1);this.ctx.fillStyle=`rgba(${e.r}, ${e.g}, ${e.b}, 255)`,this.ctx.beginPath(),this.ctx.arc(_t.parsePointX(t),_t.parsePointY(t),_t.parseBrushSize(t),0,2*Math.PI,!1),this.ctx.fill()}}function Ot(t,e,n){const r=t.slice();return r[4]=e[n],r}function Ft(t){let e,n=t[0].keyframes,r=[];for(let e=0;e<n.length;e+=1)r[e]=Mt(Ot(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=y()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);h(t,e,n)},p(t,o){if(3&o){let i;for(n=t[0].keyframes,i=0;i<n.length;i+=1){const s=Ot(t,n,i);r[i]?r[i].p(s,o):(r[i]=Mt(s),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(t){d(r,t),t&&p(e)}}}function Mt(t){let e,n,r;function o(){return t[3](t[4])}return{c(){e=f("span"),g(e,"class","keyframe svelte-cpouo2"),P(e,"top",_t.parsePointY(t[4].point)-5+"px"),P(e,"left",_t.parsePointX(t[4].point)-5+"px")},m(t,i){h(t,e,i),n||(r=b(e,"click",o),n=!0)},p(n,r){t=n,1&r&&P(e,"top",_t.parsePointY(t[4].point)-5+"px"),1&r&&P(e,"left",_t.parsePointX(t[4].point)-5+"px")},d(t){t&&p(e),n=!1,r()}}}function At(e){let n,r=null!=e[0]&&Ft(e);return{c(){r&&r.c(),n=y()},m(t,e){r&&r.m(t,e),h(t,n,e)},p(t,[e]){null!=t[0]?r?r.p(t,e):(r=Ft(t),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:t,o:t,d(t){r&&r.d(t),t&&p(n)}}}function Lt(t,e,n){let{path:r}=e,o=[];const i=t=>{t.speed=parseInt(prompt("New speed",t.speed.toString()))};return t.$$set=t=>{"path"in t&&n(0,r=t.path)},t.$$.update=()=>{5&t.$$.dirty&&(o.forEach((t=>t.unsubscribe())),n(2,o=[]),null!=r&&(o.push(r.newKeyframe$.subscribe((t=>{n(0,r),n(2,o),i(t)}))),o.push(r.changed$.subscribe((t=>{n(0,r),n(2,o)})))))},[r,i,o,t=>{i(t)}]}class Dt extends U{constructor(t){super(),B(this,t,Lt,At,i,{path:0})}}function Rt(t,e){return new Promise((n=>t.addEventListener(e,n,{once:!0})))}class zt{constructor(t,e=30){this.FPS=e,this.source=t;const n=this.canvas=t.cloneNode();(this.drawingContext=n.getContext("2d")).drawImage(t,0,0);const r=this.stream=n.captureStream(0),o=this.track=r.getVideoTracks()[0];o.requestFrame||(o.requestFrame=()=>r.requestFrame());const i=this.recorder=new MediaRecorder(r,{bitsPerSecond:25e6}),s=this.chunks=[];i.ondataavailable=t=>s.push(t.data),i.start(),Rt(i,"start").then((t=>i.pause())),this._init=Rt(i,"pause")}async recordFrame(){await this._init;const t=this.recorder,e=this.canvas,n=this.source,r=this.drawingContext;e.width===n.width&&e.height===n.height||(e.width=n.width,e.height=n.height);const o=(i=1e3/this.FPS,new Promise((t=>setTimeout(t,i))));var i;t.resume(),await Rt(t,"resume"),r.clearRect(0,0,e.width,e.height),r.drawImage(n,0,0),this.track.requestFrame(),await o,t.pause(),await Rt(t,"pause")}async export(){return this.recorder.stop(),this.stream.getTracks().forEach((t=>t.stop())),await Rt(this.recorder,"stop"),new Blob(this.chunks,{type:"video/mp4"})}}function Nt(t,e,n){const r=t.slice();return r[48]=e[n],r}function It(e){let n,r,o;return{c(){n=f("button"),n.innerHTML='<span class="material-icons">stop</span>',g(n,"class","svelte-71jokk")},m(t,i){h(t,n,i),r||(o=b(n,"click",e[22]),r=!0)},p:t,d(t){t&&p(n),r=!1,o()}}}function Yt(e){let n,r,o;return{c(){n=f("button"),n.innerHTML='<span class="material-icons">play_arrow</span>',g(n,"class","svelte-71jokk")},m(t,i){h(t,n,i),r||(o=b(n,"click",e[21]),r=!0)},p:t,d(t){t&&p(n),r=!1,o()}}}function Bt(t){let e,n,r,o,i=t[48].name+"";return{c(){e=f("option"),n=v(i),r=m(),e.__value=o=t[48].id,e.value=e.__value},m(t,o){h(t,e,o),u(e,n),u(e,r)},p(t,r){1&r[0]&&i!==(i=t[48].name+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,i),1&r[0]&&o!==(o=t[48].id)&&(e.__value=o,e.value=e.__value)},d(t){t&&p(e)}}}function Ut(t){let e,n,o,i,s,a,c,l,u,d,v,y,x,_,$,S;return{c(){e=f("span"),e.textContent="Path name",n=m(),o=f("input"),i=m(),s=f("span"),s.textContent="Speed",a=m(),c=f("input"),l=m(),u=f("span"),u.textContent="Start delay (ms)",d=m(),v=f("input"),y=f("br"),x=m(),_=f("button"),_.textContent="Delete path",g(e,"class","miniheader svelte-71jokk"),g(o,"type","text"),g(o,"class","svelte-71jokk"),g(s,"class","miniheader svelte-71jokk"),g(c,"type","range"),g(c,"min","1"),g(c,"max","1500"),g(c,"class","svelte-71jokk"),g(u,"class","miniheader svelte-71jokk"),g(v,"type","number"),g(v,"class","svelte-71jokk"),P(_,"background-color","#e53e3e"),P(_,"margin-top","15px"),g(_,"class","svelte-71jokk")},m(r,p){h(r,e,p),h(r,n,p),h(r,o,p),k(o,t[2].name),h(r,i,p),h(r,s,p),h(r,a,p),h(r,c,p),k(c,t[2].pointsPerSecond),h(r,l,p),h(r,u,p),h(r,d,p),h(r,v,p),k(v,t[2].delay),h(r,y,p),h(r,x,p),h(r,_,p),$||(S=[b(o,"input",t[31]),b(o,"change",t[32]),b(c,"change",t[33]),b(c,"input",t[33]),b(v,"input",t[34]),b(_,"click",t[35])],$=!0)},p(t,e){5&e[0]&&o.value!==t[2].name&&k(o,t[2].name),5&e[0]&&k(c,t[2].pointsPerSecond),5&e[0]&&w(v.value)!==t[2].delay&&k(v,t[2].delay)},d(t){t&&p(e),t&&p(n),t&&p(o),t&&p(i),t&&p(s),t&&p(a),t&&p(c),t&&p(l),t&&p(u),t&&p(d),t&&p(v),t&&p(y),t&&p(x),t&&p(_),$=!1,r(S)}}}function Xt(t){let e,n,o,i,s,a,v,y,w,_,$,S,j,C,T,E,O,F,M,A,L,D,Y,B,U,X,H,K,q,J,V,Z,G,Q,W,tt,et,nt,rt,ot,it,st,at,ct,lt,ut,ht,pt,dt,ft,vt,mt,yt,bt,gt;function wt(t,e){return-1==t[10]?Yt:It}let kt=wt(t),Pt=kt(t),xt=t[0].paths,_t=[];for(let e=0;e<xt.length;e+=1)_t[e]=Bt(Nt(t,xt,e));let $t=null!=t[2]&&Ut(t);return dt=new Dt({props:{path:t[2]}}),{c(){e=f("main"),n=f("div"),o=f("div"),i=f("input"),s=m(),a=f("div"),Pt.c(),v=m(),y=f("button"),y.innerHTML='<span class="material-icons">image</span>',w=m(),_=f("button"),_.innerHTML='<span class="material-icons">download</span>',$=m(),S=f("button"),S.innerHTML='<span class="material-icons">upload</span>',j=m(),C=f("button"),C.innerHTML='<span class="material-icons">layers_clear</span>',T=m(),E=f("button"),O=f("span"),O.textContent="brush",M=m(),A=f("button"),L=f("span"),L.textContent="clear",Y=m(),B=f("button"),B.innerHTML='<span class="material-icons">movie</span>',U=m(),X=f("div"),H=f("select");for(let t=0;t<_t.length;t+=1)_t[t].c();var r;K=f("option"),q=f("option"),q.textContent="Add Path",V=m(),$t&&$t.c(),Z=m(),G=f("div"),Q=f("span"),Q.textContent="Brush size",W=m(),tt=f("input"),et=m(),nt=f("span"),nt.textContent="Background color",rt=m(),ot=f("input"),it=m(),st=f("div"),at=f("div"),ct=f("img"),ut=m(),ht=f("canvas"),pt=m(),(r=dt.$$.fragment)&&r.c(),ft=m(),vt=f("div"),mt=f("canvas"),g(i,"type","text"),g(i,"placeholder","Project Name"),g(i,"class","svelte-71jokk"),g(y,"title","Open image"),g(y,"class","svelte-71jokk"),g(_,"class","svelte-71jokk"),g(S,"class","svelte-71jokk"),g(C,"title","Clear all layers"),g(C,"class","svelte-71jokk"),g(O,"class","material-icons"),g(E,"class",F=l(t[13]?"":"selected")+" svelte-71jokk"),g(L,"class","material-icons"),g(A,"title","Erase"),g(A,"class",D=l(t[13]?"selected":"")+" svelte-71jokk"),g(B,"title","Render"),g(B,"class","svelte-71jokk"),g(a,"class","topbar svelte-71jokk"),K.__value=-1,K.value=K.__value,q.__value=-2,q.value=q.__value,g(H,"class","svelte-71jokk"),P(X,"text-align","right"),g(o,"class","sidebartop svelte-71jokk"),g(Q,"class","miniheader svelte-71jokk"),g(tt,"type","range"),g(tt,"min","1"),g(tt,"max","20"),g(tt,"class","svelte-71jokk"),g(nt,"class","miniheader svelte-71jokk"),g(ot,"type","color"),g(ot,"class","svelte-71jokk"),g(G,"class","footer"),g(n,"class","sidebar svelte-71jokk"),c(ct.src,lt=t[4])||g(ct,"src",lt),P(ct,"background-color",t[0].backgroundColor),g(ht,"width",t[8]),g(ht,"height",t[9]),g(ht,"class","svelte-71jokk"),g(at,"class","overlay image svelte-71jokk"),P(at,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[12]}" viewBox="0 0 ${2*t[12]} ${2*t[12]}" width="${2*t[12]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[12]}" cy="${t[12]}" r="${t[12]}"/></svg>') ${t[12]} ${t[12]}, auto`),g(mt,"width",t[8]),g(mt,"height",t[9]),P(mt,"background-color",t[0].backgroundColor),g(vt,"class","image svelte-71jokk"),g(st,"class","imagesContainer svelte-71jokk"),g(e,"class","svelte-71jokk")},m(r,c){h(r,e,c),u(e,n),u(n,o),u(o,i),k(i,t[14]),u(o,s),u(o,a),Pt.m(a,null),u(a,v),u(a,y),u(a,w),u(a,_),u(a,$),u(a,S),u(a,j),u(a,C),u(a,T),u(a,E),u(E,O),u(a,M),u(a,A),u(A,L),u(a,Y),u(a,B),u(o,U),u(o,X),u(X,H);for(let t=0;t<_t.length;t+=1)_t[t].m(H,null);u(H,K),u(H,q),x(H,t[2]?.id??-1),u(o,V),$t&&$t.m(o,null),u(n,Z),u(n,G),u(G,Q),u(G,W),u(G,tt),k(tt,t[12]),u(G,et),u(G,nt),u(G,rt),u(G,ot),k(ot,t[0].backgroundColor),u(e,it),u(e,st),u(st,at),u(at,ct),t[38](ct),u(at,ut),u(at,ht),t[40](ht),u(at,pt),N(dt,at,null),u(st,ft),u(st,vt),u(vt,mt),t[42](mt),yt=!0,bt||(gt=[b(i,"input",t[20]),b(y,"click",t[23]),b(_,"click",t[24]),b(S,"click",t[25]),b(C,"click",t[26]),b(E,"click",t[27]),b(A,"click",t[28]),b(B,"click",t[29]),b(H,"change",t[30]),b(tt,"change",t[36]),b(tt,"input",t[36]),b(ot,"input",t[37]),b(ct,"load",t[39]),b(ht,"mousemove",t[18]),b(ht,"wheel",t[41])],bt=!0)},p(t,e){if(16384&e[0]&&i.value!==t[14]&&k(i,t[14]),kt===(kt=wt(t))&&Pt?Pt.p(t,e):(Pt.d(1),Pt=kt(t),Pt&&(Pt.c(),Pt.m(a,v))),(!yt||8192&e[0]&&F!==(F=l(t[13]?"":"selected")+" svelte-71jokk"))&&g(E,"class",F),(!yt||8192&e[0]&&D!==(D=l(t[13]?"selected":"")+" svelte-71jokk"))&&g(A,"class",D),1&e[0]){let n;for(xt=t[0].paths,n=0;n<xt.length;n+=1){const r=Nt(t,xt,n);_t[n]?_t[n].p(r,e):(_t[n]=Bt(r),_t[n].c(),_t[n].m(H,K))}for(;n<_t.length;n+=1)_t[n].d(1);_t.length=xt.length}(!yt||5&e[0]&&J!==(J=t[2]?.id??-1))&&x(H,t[2]?.id??-1),null!=t[2]?$t?$t.p(t,e):($t=Ut(t),$t.c(),$t.m(o,null)):$t&&($t.d(1),$t=null),4096&e[0]&&k(tt,t[12]),1&e[0]&&k(ot,t[0].backgroundColor),(!yt||16&e[0]&&!c(ct.src,lt=t[4]))&&g(ct,"src",lt),(!yt||1&e[0])&&P(ct,"background-color",t[0].backgroundColor),(!yt||256&e[0])&&g(ht,"width",t[8]),(!yt||512&e[0])&&g(ht,"height",t[9]);const n={};4&e[0]&&(n.path=t[2]),dt.$set(n),(!yt||4096&e[0])&&P(at,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[12]}" viewBox="0 0 ${2*t[12]} ${2*t[12]}" width="${2*t[12]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[12]}" cy="${t[12]}" r="${t[12]}"/></svg>') ${t[12]} ${t[12]}, auto`),(!yt||256&e[0])&&g(mt,"width",t[8]),(!yt||512&e[0])&&g(mt,"height",t[9]),(!yt||1&e[0])&&P(mt,"background-color",t[0].backgroundColor)},i(t){yt||(z(dt.$$.fragment,t),yt=!0)},o(t){!function(t,e,n,r){if(t&&t.o){if(R.has(t))return;R.add(t),(void 0).c.push((()=>{R.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}(dt.$$.fragment,t),yt=!1},d(n){n&&p(e),Pt.d(),d(_t,n),$t&&$t.d(),t[38](null),t[40](null),I(dt),t[42](null),bt=!1,r(gt)}}}function Ht(t,e,n){let r,o,i,s,a,c,l,u,h=null,p=null,d=0,f=0,v=new Ct,m=new xt;const y=()=>{v.paths.length>0&&n(2,c=v.paths[0])};y();let b=-1,g=-1,k=10,P=!1,x="";const _=()=>""!=x?x:"Animation";let S=(C=document.createElement("a"),document.body.appendChild(C),C.style.display="none",function(t,e){let n=window.URL.createObjectURL(t);C.href=n,C.download=e,C.click(),window.URL.revokeObjectURL(n)});var C;$((async()=>{n(19,s=new Et(r)),n(1,a=new Tt(o)),n(1,a.image=i,a)}));let T=0,E=0;document.onkeydown=t=>{if(t.target===document.body&&t.ctrlKey)switch(t.key){case"z":m.undo(),t.preventDefault();break;case"Z":case"y":m.redo(),t.preventDefault();break;case"k":if(null==c)return;c.addKeyframe(T,E,k),t.preventDefault();break;case"p":n(2,c=v.addPath()),n(0,v),t.preventDefault()}};return t.$$.update=()=>{3&t.$$.dirty[0]&&null!=a&&n(1,a.painting=v,a),524292&t.$$.dirty[0]&&null!=s&&n(19,s.currentPath=c,s),24&t.$$.dirty[0]&&(null!=u&&(URL.revokeObjectURL(u),n(4,u=null)),null!=l&&n(4,u=URL.createObjectURL(l)))},[v,a,c,l,u,r,o,i,d,f,b,g,k,P,x,y,_,S,t=>{if(null==c)return;let e=r.getBoundingClientRect();T=t.clientX-e.left,E=t.clientY-e.top,0!=t.buttons?(null!=h&&function(t,e,n,r,o){for(var i=Math.abs(t-n),s=Math.abs(e-r),a=n<t?1:-1,c=r<e?1:-1,l=i-s;o(n,r),!(Math.abs(n-t)<1e-4&&Math.abs(r-e)<1e-4);){var u=2*l;u>-s&&(l-=s,n+=a),u<i&&(l+=i,r+=c)}}(h,p,T,E,((t,e)=>P?c.eraseRadius(t,e,k):c.addPoint(t,e,k))),h=T,p=E):(null!=h&&m.pushState(c.finishTransaction()),c.strokeDone(),h=null)},s,function(){x=this.value,n(14,x)},()=>{a.prepare(),n(11,g=-1);const t=()=>n(10,b=window.requestAnimationFrame((e=>{-1!=g?a.drawNextFrame((e-g)/1e3)?t():n(10,b=-1):(n(11,g=e),t()),n(11,g=e)})));t()},()=>{window.cancelAnimationFrame(b),n(10,b=-1)},()=>{!function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{t(e.files[0])}))}((t=>{!v.clean&&confirm("Are you sure you have saved?")&&(n(0,v=new Ct),y()),n(3,l=t)}))},()=>{var t=JSON.stringify(v.flatten()),e=new Blob([t],{type:"octet/stream"});S(e,_())},()=>{(v.clean||confirm("Are you sure you have saved?"))&&function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{var n=new FileReader;n.onload=function(){document.body.removeChild(e),t(JSON.parse(n.result.toString()),e.files[0].name)},n.readAsText(e.files[0])}))}(((t,e)=>{n(0,v=Ct.restore(t)),n(14,x=e),y()}))},()=>{confirm("Are you sure you have saved?")&&(n(0,v=new Ct),y())},()=>{n(13,P=!1)},()=>{n(13,P=!0)},async()=>{const t=new zt(o,60);for(a.prepare();a.drawNextFrame(1/60);)await t.recordFrame();const e=await t.export();S(e,`${_()}.webm`)},t=>{const e=t.currentTarget.value;n(2,c="-1"==e?null:"-2"==e?v.addPath():v.paths.find((t=>t.id==parseInt(e)))),n(0,v)},function(){c.name=this.value,n(2,c),n(0,v)},()=>n(0,v),function(){c.pointsPerSecond=w(this.value),n(2,c),n(0,v)},function(){c.delay=w(this.value),n(2,c),n(0,v)},()=>{v.paths.splice(v.paths.indexOf(c),1),n(2,c=null),n(0,v)},function(){k=w(this.value),n(12,k)},function(){v.backgroundColor=this.value,n(0,v)},function(t){j[t?"unshift":"push"]((()=>{i=t,n(7,i)}))},()=>{n(8,d=i.width),n(9,f=i.height)},function(t){j[t?"unshift":"push"]((()=>{r=t,n(5,r)}))},t=>{n(12,k+=t.deltaY>0?-1:1),t.preventDefault()},function(t){j[t?"unshift":"push"]((()=>{o=t,n(6,o)}))}]}return new class extends U{constructor(t){super(),B(this,t,Ht,Xt,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
