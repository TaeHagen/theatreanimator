var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function i(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let o,a;function c(t,e){return o||(o=document.createElement("a")),o.href=e,t===o.href}function l(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function d(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function v(){return m(" ")}function g(){return m("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t){return""===t?null:+t}function P(t,e){t.value=null==e?"":e}function x(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function k(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function S(t){a=t}function $(t){(function(){if(!a)throw new Error("Function called outside component initialization");return a})().$$.on_mount.push(t)}const _=[],T=[],C=[],E=[],I=Promise.resolve();let A=!1;function R(t){C.push(t)}const O=new Set;let F=0;function L(){const t=a;do{for(;F<_.length;){const t=_[F];F++,S(t),M(t.$$)}for(S(null),_.length=0,F=0;T.length;)T.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];O.has(e)||(O.add(e),e())}C.length=0}while(_.length);for(;E.length;)E.pop()();A=!1,O.clear(),S(t)}function M(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(R)}}const D=new Set;function N(t,e){t&&t.i&&(D.delete(t),t.i(e))}function j(t,n,s,o){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,s),o||R((()=>{const n=c.map(e).filter(i);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(R)}function z(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Y(t,e){-1===t.$$.dirty[0]&&(_.push(t),A||(A=!0,I.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function B(e,i,s,o,c,l,u,h=[-1]){const d=a;S(e);const f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(d?d.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:i.target||d.$$.root};u&&u(f.root);let m=!1;if(f.ctx=s?s(e,i.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return f.ctx&&c(f.ctx[t],f.ctx[t]=i)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](i),m&&Y(e,t)),n})):[],f.update(),m=!0,r(f.before_update),f.fragment=!!o&&o(f.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);f.fragment&&f.fragment.l(t),t.forEach(p)}else f.fragment&&f.fragment.c();i.intro&&N(e.$$.fragment),j(e,i.target,i.anchor,i.customElement),L()}S(d)}class X{$destroy(){z(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var H=function(t,e){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},H(t,e)};function U(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}H(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function K(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function W(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function J(t){return"function"==typeof t}function V(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Z=V((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function G(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Q=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=K(s),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else s.remove(this);var c=this.initialTeardown;if(J(c))try{c()}catch(t){i=t instanceof Z?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=K(l),h=u.next();!h.done;h=u.next()){var p=h.value;try{nt(p)}catch(t){i=null!=i?i:[],t instanceof Z?i=W(W([],q(i)),q(t.errors)):i.push(t)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new Z(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nt(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&G(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&G(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),tt=Q.EMPTY;function et(t){return t instanceof Q||t&&"closed"in t&&J(t.remove)&&J(t.add)&&J(t.unsubscribe)}function nt(t){J(t)?t():t.unsubscribe()}var rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},it={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=it.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,W([t,e],q(n))):setTimeout.apply(void 0,W([t,e],q(n)))},clearTimeout:function(t){var e=it.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function st(){}var ot=null;function at(t){if(rt.useDeprecatedSynchronousErrorHandling){var e=!ot;if(e&&(ot={errorThrown:!1,error:null}),t(),e){var n=ot,r=n.errorThrown,i=n.error;if(ot=null,r)throw i}}else t()}var ct=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,et(e)&&e.add(n)):n.destination=ft,n}return U(e,t),e.create=function(t,e,n){return new pt(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Q),lt=Function.prototype.bind;function ut(t,e){return lt.call(t,e)}var ht=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){dt(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){dt(t)}else dt(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){dt(t)}},t}(),pt=function(t){function e(e,n,r){var i,s,o=t.call(this)||this;J(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&rt.useDeprecatedNextContext?((s=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},i={next:e.next&&ut(e.next,s),error:e.error&&ut(e.error,s),complete:e.complete&&ut(e.complete,s)}):i=e;return o.destination=new ht(i),o}return U(e,t),e}(ct);function dt(t){var e;e=t,it.setTimeout((function(){throw e}))}var ft={closed:!0,next:st,error:function(t){throw t},complete:st},mt="function"==typeof Symbol&&Symbol.observable||"@@observable";function vt(t){return t}function gt(t){return 0===t.length?vt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var bt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,i=this,s=(r=t)&&r instanceof ct||function(t){return t&&J(t.next)&&J(t.error)&&J(t.complete)}(r)&&et(r)?t:new pt(t,e,n);return at((function(){var t=i,e=t.operator,n=t.source;s.add(e?e.call(s,n):n?i._subscribe(s):i._trySubscribe(s))})),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=yt(e))((function(e,r){var i=new pt({next:function(e){try{t(e)}catch(t){r(t),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[mt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return gt(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=yt(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function yt(t){var e;return null!==(e=null!=t?t:rt.Promise)&&void 0!==e?e:Promise}var wt=V((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Pt=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return U(e,t),e.prototype.lift=function(t){var e=new xt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new wt},e.prototype.next=function(t){var e=this;at((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=K(e.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(t)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;at((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;at((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,i=n.isStopped,s=n.observers;return r||i?tt:(this.currentObservers=null,s.push(t),new Q((function(){e.currentObservers=null,G(s,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,i=e.isStopped;n?t.error(r):i&&t.complete()},e.prototype.asObservable=function(){var t=new bt;return t.source=this,t},e.create=function(t,e){return new xt(t,e)},e}(bt),xt=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return U(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:tt},e}(Pt);class kt{constructor(){this.states=[],this.pointer=-1}pushState(t){this.pointer!==this.states.length-1&&this.states.splice(this.pointer+1),this.states.push(t),this.pointer++}undo(){this.pointer<0||(this.states[this.pointer].undo(),this.pointer--)}redo(){this.pointer+1!==this.states.length&&(this.states[this.pointer+1].redo(),this.pointer++)}}const St={createPoint:(t,e,n,r)=>[t,e,n,r],parsePointX:t=>t[0],parsePointY:t=>t[1],parsePointTime:t=>t[2],parseBrushSize:t=>t[3],flatten:t=>({x:St.parsePointX(t),y:St.parsePointY(t),time:St.parsePointTime(t),brushSize:St.parseBrushSize(t)}),restore:t=>St.createPoint(t.x,t.y,t.time,t.brushSize)};class $t{constructor(t){this.point=t,this.speed=500}flatten(){return{point:St.flatten(this.point),speed:this.speed}}static restore(t){const e=new $t(St.restore(t.point));return e.speed=t.speed,e}apply(t){t.effectivePointsPerSeconds=this.speed}}var _t;function Tt(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{t(e.files[0])}))}!function(t){t[t.PAINT=0]="PAINT",t[t.ERASE=1]="ERASE",t[t.SELECT=2]="SELECT"}(_t||(_t={}));let Ct=0;class Et{constructor(){this.id=Ct++,this.name="New Path",this.points=[],this.transaction=[],this.eraseTransaction=[],this.keyframes=[],this.perfectRendering=!1,this.pointsPerSecond=250,this.effectivePointsPerSeconds=this.pointsPerSecond,this.delay=0,this.lastPoint=null,this.newPoint$=new Pt,this.newKeyframe$=new Pt,this.changed$=new Pt}get clean(){return 0==this.points.length&&0==this.keyframes.length}findDist(t,e,n,r){return Math.sqrt(Math.abs(e-t)**2+Math.abs(r-n)**2)}isPointInPath(t,e){return this.points.some((n=>this.findDist(St.parsePointX(n),t,St.parsePointY(n),e)<=St.parseBrushSize(n)))}applyKeyframesForPoint(t){this.effectivePointsPerSeconds=this.pointsPerSecond,this.keyframes.filter((e=>St.parsePointTime(e.point)<=t)).map((t=>t.apply(this)))}flatten(){return{points:this.points.map((t=>St.flatten(t))),keyframes:this.keyframes.map((t=>t.flatten())),pointsPerSecond:this.pointsPerSecond,name:this.name,id:this.id,delay:this.delay,perfectRendering:this.perfectRendering}}static restore(t){const e=new Et;return e.points=t.points.map((t=>St.restore(t))),e.keyframes=t.keyframes.map((t=>$t.restore(t))),e.pointsPerSecond=t.pointsPerSecond,e.name=t.name,e.id=t.id,e.delay=t.delay,null!=t.perfectRendering&&(e.perfectRendering=t.perfectRendering),e}findClosestPoint(t,e){if(0==this.points.length)return null;let n,r,i,s=this.points[0];const o=()=>{n=St.parsePointX(s),r=St.parsePointY(s),i=this.findDist(n,t,r,e)};o();for(const n of this.points){const r=St.parsePointX(n),a=St.parsePointY(n);this.findDist(r,t,a,e)<i&&(s=n,o())}return s}addPoint(t,e,n){if(this.lastPoint=this.findClosestPoint(t,e),null!=this.lastPoint){const n=St.parsePointX(this.lastPoint),r=St.parsePointY(this.lastPoint);if(n==t&&r==e)return}const r=St.createPoint(t,e,null!=this.lastPoint?St.parsePointTime(this.lastPoint)+1:0,n);this.points.push(r),this.transaction.push(r),this.lastPoint=r,this.newPoint$.next(r)}eraseRadius(t,e,n){this.points=this.points.filter((r=>{const i=this.findDist(t,St.parsePointX(r),e,St.parsePointY(r))>n;return i||this.eraseTransaction.push(r),i})),this.changed$.next()}addKeyframe(t,e,n){var r;const i=new $t(St.createPoint(t,e,null!==(r=St.parsePointTime(this.findClosestPoint(t,e))+1)&&void 0!==r?r:0,n));this.keyframes.push(i),this.newKeyframe$.next(i)}finishTransaction(){const t=this.transaction,e=this.eraseTransaction;return this.transaction=[],this.eraseTransaction=[],{name:"Add stroke",undo:()=>{this.points=this.points.filter((e=>!t.includes(e))).concat(e),this.changed$.next()},redo:()=>{this.points=this.points.concat(t).filter((t=>!e.includes(t))),this.changed$.next()}}}strokeDone(){this.lastPoint=null}}class It{constructor(){this.paths=[new Et],this.backgroundColor="#FFFFFF",this.desiredTime=0,this.fadeTime=1}addPath(){const t=new Et;return this.paths.push(t),t}findPathAtPoint(t,e){return this.paths.find((n=>n.isPointInPath(t,e)))}flatten(){return{paths:this.paths.map((t=>t.flatten())),backgroundColor:this.backgroundColor,desiredTime:this.desiredTime,fadeTime:this.fadeTime}}get clean(){return this.paths.every((t=>t.clean))}static restore(t){const e=new It;return e.paths=t.paths.map((t=>Et.restore(t))),e.backgroundColor=t.backgroundColor,null!=t.desiredTime&&(e.desiredTime=t.desiredTime),null!=t.fadeTime&&(e.fadeTime=t.fadeTime),e}}class At{constructor(t){this.canvas=t,this.totalPoints=0,this.pathProgress=new Map,this.pathPoints=new Map,this.timeWarp=1,this.endTime=0,this.secSinceStart=0,this.ctx=t.getContext("2d")}allDrawn(){for(const t of this.pathPoints.values())if(t.length>0)return!1;return!0}willDrawEndFade(){return null!=this.doneImage}drawAllPoints(t){const e=t.getContext("2d");for(const n of this.painting.paths){e.save(),e.beginPath();for(const t of n.points)this.drawPoint(t,e);e.clip(),e.fillStyle=this.painting.backgroundColor,e.fillRect(0,0,t.width,t.height),null!=this.backgroundImage&&this.ctx.drawImage(this.backgroundImage,0,0),e.drawImage(this.image,0,0),e.restore()}}drawNextFrame(t){t*=this.timeWarp,this.secSinceStart+=t;const e=this.pointsForPaths(t);if(this.allDrawn())return!!(this.endTime<=this.painting.fadeTime&&this.willDrawEndFade())&&(this.endTime+=t/this.timeWarp,this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.allPointsCanvas,0,0),this.ctx.globalAlpha=this.endTime/this.painting.fadeTime,this.ctx.drawImage(this.doneImage,0,0),this.ctx.globalAlpha=1,!0);for(const t of e)if(t.perfect)for(const e of t.points)this.ctx.save(),this.ctx.beginPath(),this.drawPoint(e),this.ctx.clip(),this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),null!=this.backgroundImage&&this.ctx.drawImage(this.backgroundImage,0,0),this.ctx.drawImage(this.image,0,0),this.ctx.restore();else{this.ctx.save(),this.ctx.beginPath();for(const e of t.points)this.drawPoint(e);this.ctx.clip(),this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),null!=this.backgroundImage&&this.ctx.drawImage(this.backgroundImage,0,0),this.ctx.drawImage(this.image,0,0),this.ctx.restore()}return!0}countTime(t){const e=1/t;this.prepare(0,void 0,!1);let n=0;for(;!this.allDrawn();)this.pointsForPaths(e),n+=e;return n}pointsForPaths(t){return this.painting.paths.map((e=>{var n,r;if(this.secSinceStart<e.delay/1e3)return null;let i=null!==(n=this.pathProgress.get(e))&&void 0!==n?n:0;i+=t*e.effectivePointsPerSeconds,this.pathProgress.set(e,i),e.applyKeyframesForPoint(i);let s=null!==(r=this.pathPoints.get(e))&&void 0!==r?r:e.points,o=[];return s=s.filter((t=>{const e=St.parsePointTime(t)<=i;return e&&o.push(t),!e})),this.pathPoints.set(e,s),{points:o,perfect:e.perfectRendering}})).filter((t=>null!=t))}prepare(t=this.painting.desiredTime,e=60,n=!0){if(this.timeWarp=1,this.endTime=0,this.allPointsCanvas=document.createElement("canvas"),this.allPointsCanvas.width=this.canvas.width,this.allPointsCanvas.height=this.canvas.height,this.drawAllPoints(this.allPointsCanvas),0!=t){const n=this.countTime(e);this.timeWarp=n/t}n&&(this.ctx.fillStyle=this.painting.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),null!=this.backgroundImage&&this.ctx.drawImage(this.backgroundImage,0,0)),this.totalPoints=this.painting.paths.reduce(((t,e)=>t+e.points.length),0),this.pathProgress.clear(),this.secSinceStart=0,this.pathProgress.clear();for(const t of this.painting.paths)this.pathPoints.set(t,t.points)}drawPoint(t,e=this.ctx){e.arc(St.parsePointX(t),St.parsePointY(t),St.parseBrushSize(t),0,2*Math.PI)}}class Rt{constructor(t){this.canvas=t,this.currentPathSubscriptions=[],this.ctx=t.getContext("2d")}set currentPath(t){this._currentPath=t,this.currentPathSubscriptions.forEach((t=>t.unsubscribe())),this.redrawPath(),null!=t&&(this.currentPathSubscriptions.push(t.newPoint$.subscribe((t=>this.drawPoint(t)))),this.currentPathSubscriptions.push(t.changed$.subscribe((()=>this.redrawPath()))))}get currentPath(){return this._currentPath}redrawPath(){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),null!=this.currentPath)for(const t of this.currentPath.points)this.drawPoint(t)}drawPoint(t){const e=function(t,e,n){var r,i,s,o,a,c,l,u;switch(1===arguments.length&&(e=t.s,n=t.v,t=t.h),c=n*(1-e),l=n*(1-(a=6*t-(o=Math.floor(6*t)))*e),u=n*(1-(1-a)*e),o%6){case 0:r=n,i=u,s=c;break;case 1:r=l,i=n,s=c;break;case 2:r=c,i=n,s=u;break;case 3:r=c,i=l,s=n;break;case 4:r=u,i=c,s=n;break;case 5:r=n,i=c,s=l}return{r:Math.round(255*r),g:Math.round(255*i),b:Math.round(255*s)}}(St.parsePointTime(t)/1e3,1,1);this.ctx.fillStyle=`rgba(${e.r}, ${e.g}, ${e.b}, 255)`,this.ctx.beginPath(),this.ctx.arc(St.parsePointX(t),St.parsePointY(t),St.parseBrushSize(t),0,2*Math.PI,!1),this.ctx.fill()}}function Ot(t,e,n){const r=t.slice();return r[4]=e[n],r}function Ft(t){let e,n=t[0].keyframes,r=[];for(let e=0;e<n.length;e+=1)r[e]=Lt(Ot(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=g()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);h(t,e,n)},p(t,i){if(3&i){let s;for(n=t[0].keyframes,s=0;s<n.length;s+=1){const o=Ot(t,n,s);r[s]?r[s].p(o,i):(r[s]=Lt(o),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=n.length}},d(t){d(r,t),t&&p(e)}}}function Lt(t){let e,n,r;function i(){return t[3](t[4])}return{c(){e=f("span"),y(e,"class","keyframe svelte-cpouo2"),x(e,"top",St.parsePointY(t[4].point)-5+"px"),x(e,"left",St.parsePointX(t[4].point)-5+"px")},m(t,s){h(t,e,s),n||(r=b(e,"click",i),n=!0)},p(n,r){t=n,1&r&&x(e,"top",St.parsePointY(t[4].point)-5+"px"),1&r&&x(e,"left",St.parsePointX(t[4].point)-5+"px")},d(t){t&&p(e),n=!1,r()}}}function Mt(e){let n,r=null!=e[0]&&Ft(e);return{c(){r&&r.c(),n=g()},m(t,e){r&&r.m(t,e),h(t,n,e)},p(t,[e]){null!=t[0]?r?r.p(t,e):(r=Ft(t),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:t,o:t,d(t){r&&r.d(t),t&&p(n)}}}function Dt(t,e,n){let{path:r}=e,i=[];const s=t=>{t.speed=parseInt(prompt("New speed",t.speed.toString()))};return t.$$set=t=>{"path"in t&&n(0,r=t.path)},t.$$.update=()=>{5&t.$$.dirty&&(i.forEach((t=>t.unsubscribe())),n(2,i=[]),null!=r&&(i.push(r.newKeyframe$.subscribe((t=>{n(0,r),n(2,i),s(t)}))),i.push(r.changed$.subscribe((t=>{n(0,r),n(2,i)})))))},[r,s,i,t=>{s(t)}]}class Nt extends X{constructor(t){super(),B(this,t,Dt,Mt,s,{path:0})}}function jt(t,e){return new Promise((n=>t.addEventListener(e,n,{once:!0})))}class zt{constructor(t,e=30){this.FPS=e,this.frames=0,this.source=t;const n=this.canvas=t.cloneNode();(this.drawingContext=n.getContext("2d")).drawImage(t,0,0);const r=this.stream=n.captureStream(0),i=this.track=r.getVideoTracks()[0];i.requestFrame||(i.requestFrame=()=>r.requestFrame());const s=this.recorder=new MediaRecorder(r,{bitsPerSecond:25e6}),o=this.chunks=[];s.ondataavailable=t=>o.push(t.data),s.start(),jt(s,"start").then((t=>s.pause())),this._init=jt(s,"pause")}async recordFrame(){await this._init;const t=this.recorder,e=this.canvas,n=this.source,r=this.drawingContext;e.width===n.width&&e.height===n.height||(e.width=n.width,e.height=n.height);const i=(s=1e3/this.FPS,new Promise((t=>setTimeout(t,s))));var s;t.resume(),await jt(t,"resume"),r.clearRect(0,0,e.width,e.height),r.drawImage(n,0,0),this.track.requestFrame(),await i,t.pause(),await jt(t,"pause"),this.frames++}async export(){return this.recorder.stop(),this.stream.getTracks().forEach((t=>t.stop())),await jt(this.recorder,"stop"),console.log("Frames: ",this.frames),new Blob(this.chunks,{type:"video/mp4"})}}function Yt(t,e,n){const r=t.slice();return r[56]=e[n],r}function Bt(e){let n,r,i;return{c(){n=f("button"),n.innerHTML='<span class="material-icons">stop</span>',y(n,"class","svelte-1117dn3")},m(t,s){h(t,n,s),r||(i=b(n,"click",e[26]),r=!0)},p:t,d(t){t&&p(n),r=!1,i()}}}function Xt(e){let n,r,i;return{c(){n=f("button"),n.innerHTML='<span class="material-icons">play_arrow</span>',y(n,"class","svelte-1117dn3")},m(t,s){h(t,n,s),r||(i=b(n,"click",e[25]),r=!0)},p:t,d(t){t&&p(n),r=!1,i()}}}function Ht(t){let e,n,r,i,s=t[56].name+"";return{c(){e=f("option"),n=m(s),r=v(),e.__value=i=t[56].id,e.value=e.__value},m(t,i){h(t,e,i),u(e,n),u(e,r)},p(t,r){1&r[0]&&s!==(s=t[56].name+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,s),1&r[0]&&i!==(i=t[56].id)&&(e.__value=i,e.value=e.__value)},d(t){t&&p(e)}}}function Ut(t){let e,n,i,s,o,a,c,l,u,d,m,g,k,S,$,_,T,C,E,I,A;return{c(){e=f("span"),e.textContent="Path name",n=v(),i=f("input"),s=v(),o=f("span"),o.textContent="Speed",a=v(),c=f("input"),l=v(),u=f("span"),u.textContent="Start delay (ms)",d=v(),m=f("input"),g=f("br"),k=v(),S=f("span"),S.textContent="Perfect Rendering",$=v(),_=f("input"),T=f("br"),C=v(),E=f("button"),E.textContent="Delete path",y(e,"class","miniheader svelte-1117dn3"),y(i,"type","text"),y(i,"class","svelte-1117dn3"),y(o,"class","miniheader svelte-1117dn3"),y(c,"type","range"),y(c,"min","1"),y(c,"max","1500"),y(c,"class","svelte-1117dn3"),y(u,"class","miniheader svelte-1117dn3"),y(m,"type","number"),y(m,"class","svelte-1117dn3"),y(S,"class","miniheader svelte-1117dn3"),y(_,"type","checkbox"),y(_,"class","svelte-1117dn3"),x(E,"background-color","#e53e3e"),x(E,"margin-top","15px"),y(E,"class","svelte-1117dn3")},m(r,p){h(r,e,p),h(r,n,p),h(r,i,p),P(i,t[2].name),h(r,s,p),h(r,o,p),h(r,a,p),h(r,c,p),P(c,t[2].pointsPerSecond),h(r,l,p),h(r,u,p),h(r,d,p),h(r,m,p),P(m,t[2].delay),h(r,g,p),h(r,k,p),h(r,S,p),h(r,$,p),h(r,_,p),_.checked=t[2].perfectRendering,h(r,T,p),h(r,C,p),h(r,E,p),I||(A=[b(i,"input",t[38]),b(i,"change",t[39]),b(c,"change",t[40]),b(c,"input",t[40]),b(m,"input",t[41]),b(_,"change",t[42]),b(E,"click",t[43])],I=!0)},p(t,e){5&e[0]&&i.value!==t[2].name&&P(i,t[2].name),5&e[0]&&P(c,t[2].pointsPerSecond),5&e[0]&&w(m.value)!==t[2].delay&&P(m,t[2].delay),5&e[0]&&(_.checked=t[2].perfectRendering)},d(t){t&&p(e),t&&p(n),t&&p(i),t&&p(s),t&&p(o),t&&p(a),t&&p(c),t&&p(l),t&&p(u),t&&p(d),t&&p(m),t&&p(g),t&&p(k),t&&p(S),t&&p($),t&&p(_),t&&p(T),t&&p(C),t&&p(E),I=!1,r(A)}}}function Kt(t){let e,n,i,s,o,a,m,g,S,$,_,T,C,E,I,A,R,O,F,L,M,Y,B,X,H,U,K,q,W,J,V,Z,G,Q,tt,et,nt,rt,it,st,ot,at,ct,lt,ut,ht,pt,dt,ft,mt,vt,gt,bt,yt,wt,Pt,xt,kt,St,$t,Tt,Ct,Et,It,At,Rt,Ot;function Ft(t,e){return-1==t[12]?Xt:Bt}let Lt=Ft(t),Mt=Lt(t),Dt=t[0].paths,jt=[];for(let e=0;e<Dt.length;e+=1)jt[e]=Ht(Yt(t,Dt,e));let zt=null!=t[2]&&Ut(t);return Tt=new Nt({props:{path:t[2]}}),{c(){e=f("main"),n=f("div"),i=f("div"),s=f("input"),o=v(),a=f("div"),Mt.c(),m=v(),g=f("button"),g.innerHTML='<span class="material-icons">image</span>',S=v(),$=f("button"),$.innerHTML='<span class="material-icons">verified</span>',_=v(),T=f("button"),T.innerHTML='<span class="material-icons">wallpaper</span>',C=v(),E=f("button"),E.innerHTML='<span class="material-icons">download</span>',I=v(),A=f("button"),A.innerHTML='<span class="material-icons">upload</span>',R=v(),O=f("button"),O.innerHTML='<span class="material-icons">layers_clear</span>',F=v(),L=f("button"),M=f("span"),M.textContent="brush",B=v(),X=f("button"),H=f("span"),H.textContent="clear",K=v(),q=f("button"),W=f("span"),W.textContent="adjust",V=v(),Z=f("button"),Z.innerHTML='<span class="material-icons">movie</span>',G=v(),Q=f("div"),tt=f("select");for(let t=0;t<jt.length;t+=1)jt[t].c();var r;et=f("option"),nt=f("option"),nt.textContent="Add Path",it=v(),zt&&zt.c(),st=v(),ot=f("div"),at=f("span"),at.textContent="Background color",ct=v(),lt=f("input"),ut=v(),ht=f("span"),ht.textContent="Desired time",pt=v(),dt=f("input"),ft=v(),mt=f("span"),mt.textContent="Fade time",vt=v(),gt=f("input"),bt=v(),yt=f("div"),wt=f("div"),Pt=f("img"),kt=v(),St=f("canvas"),$t=v(),(r=Tt.$$.fragment)&&r.c(),Ct=v(),Et=f("div"),It=f("canvas"),y(s,"type","text"),y(s,"placeholder","Project Name"),y(s,"class","svelte-1117dn3"),y(g,"title","Open image"),y(g,"class","svelte-1117dn3"),y($,"title","Open final fade image"),y($,"class","svelte-1117dn3"),y(T,"title","Open background image"),y(T,"class","svelte-1117dn3"),y(E,"class","svelte-1117dn3"),y(A,"class","svelte-1117dn3"),y(O,"title","Clear all layers"),y(O,"class","svelte-1117dn3"),y(M,"class","material-icons"),y(L,"class",Y=l(t[15]==_t.PAINT?"selected":"")+" svelte-1117dn3"),y(H,"class","material-icons"),y(X,"title","Erase"),y(X,"class",U=l(t[15]==_t.ERASE?"selected":"")+" svelte-1117dn3"),y(W,"class","material-icons"),y(q,"title","Select"),y(q,"class",J=l(t[15]==_t.SELECT?"selected":"")+" svelte-1117dn3"),y(Z,"title","Render"),y(Z,"class","svelte-1117dn3"),y(a,"class","topbar svelte-1117dn3"),et.__value=-1,et.value=et.__value,nt.__value=-2,nt.value=nt.__value,y(tt,"class","svelte-1117dn3"),x(Q,"text-align","right"),y(i,"class","sidebartop svelte-1117dn3"),y(at,"class","miniheader svelte-1117dn3"),y(lt,"type","color"),y(lt,"class","svelte-1117dn3"),y(ht,"class","miniheader svelte-1117dn3"),y(dt,"type","number"),y(dt,"class","svelte-1117dn3"),y(mt,"class","miniheader svelte-1117dn3"),y(gt,"type","number"),y(gt,"class","svelte-1117dn3"),y(ot,"class","footer"),y(n,"class","sidebar svelte-1117dn3"),c(Pt.src,xt=t[4])||y(Pt,"src",xt),x(Pt,"background-color",t[0].backgroundColor),y(St,"width",t[10]),y(St,"height",t[11]),y(St,"class","svelte-1117dn3"),y(wt,"class","overlay image svelte-1117dn3"),x(wt,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[14]}" viewBox="0 0 ${2*t[14]} ${2*t[14]}" width="${2*t[14]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[14]}" cy="${t[14]}" r="${t[14]}"/></svg>') ${t[14]} ${t[14]}, auto`),y(It,"width",t[10]),y(It,"height",t[11]),x(It,"background-color",t[0].backgroundColor),y(Et,"class","image svelte-1117dn3"),y(yt,"class","imagesContainer svelte-1117dn3"),y(e,"class","svelte-1117dn3")},m(r,c){h(r,e,c),u(e,n),u(n,i),u(i,s),P(s,t[16]),u(i,o),u(i,a),Mt.m(a,null),u(a,m),u(a,g),u(a,S),u(a,$),u(a,_),u(a,T),u(a,C),u(a,E),u(a,I),u(a,A),u(a,R),u(a,O),u(a,F),u(a,L),u(L,M),u(a,B),u(a,X),u(X,H),u(a,K),u(a,q),u(q,W),u(a,V),u(a,Z),u(i,G),u(i,Q),u(Q,tt);for(let t=0;t<jt.length;t+=1)jt[t].m(tt,null);u(tt,et),u(tt,nt),k(tt,t[2]?.id??-1),u(i,it),zt&&zt.m(i,null),u(n,st),u(n,ot),u(ot,at),u(ot,ct),u(ot,lt),P(lt,t[0].backgroundColor),u(ot,ut),u(ot,ht),u(ot,pt),u(ot,dt),P(dt,t[0].desiredTime),u(ot,ft),u(ot,mt),u(ot,vt),u(ot,gt),P(gt,t[0].fadeTime),u(e,bt),u(e,yt),u(yt,wt),u(wt,Pt),t[47](Pt),u(wt,kt),u(wt,St),t[49](St),u(wt,$t),j(Tt,wt,null),u(yt,Ct),u(yt,Et),u(Et,It),t[52](It),At=!0,Rt||(Ot=[b(s,"input",t[24]),b(g,"click",t[27]),b($,"click",t[28]),b(T,"click",t[29]),b(E,"click",t[30]),b(A,"click",t[31]),b(O,"click",t[32]),b(L,"click",t[33]),b(X,"click",t[34]),b(q,"click",t[35]),b(Z,"click",t[36]),b(tt,"change",t[37]),b(lt,"input",t[44]),b(dt,"input",t[45]),b(gt,"input",t[46]),b(Pt,"load",t[48]),b(St,"mousemove",t[22]),b(St,"click",t[50]),b(St,"wheel",t[51])],Rt=!0)},p(t,e){if(65536&e[0]&&s.value!==t[16]&&P(s,t[16]),Lt===(Lt=Ft(t))&&Mt?Mt.p(t,e):(Mt.d(1),Mt=Lt(t),Mt&&(Mt.c(),Mt.m(a,m))),(!At||32768&e[0]&&Y!==(Y=l(t[15]==_t.PAINT?"selected":"")+" svelte-1117dn3"))&&y(L,"class",Y),(!At||32768&e[0]&&U!==(U=l(t[15]==_t.ERASE?"selected":"")+" svelte-1117dn3"))&&y(X,"class",U),(!At||32768&e[0]&&J!==(J=l(t[15]==_t.SELECT?"selected":"")+" svelte-1117dn3"))&&y(q,"class",J),1&e[0]){let n;for(Dt=t[0].paths,n=0;n<Dt.length;n+=1){const r=Yt(t,Dt,n);jt[n]?jt[n].p(r,e):(jt[n]=Ht(r),jt[n].c(),jt[n].m(tt,et))}for(;n<jt.length;n+=1)jt[n].d(1);jt.length=Dt.length}(!At||5&e[0]&&rt!==(rt=t[2]?.id??-1))&&k(tt,t[2]?.id??-1),null!=t[2]?zt?zt.p(t,e):(zt=Ut(t),zt.c(),zt.m(i,null)):zt&&(zt.d(1),zt=null),1&e[0]&&P(lt,t[0].backgroundColor),1&e[0]&&w(dt.value)!==t[0].desiredTime&&P(dt,t[0].desiredTime),1&e[0]&&w(gt.value)!==t[0].fadeTime&&P(gt,t[0].fadeTime),(!At||16&e[0]&&!c(Pt.src,xt=t[4]))&&y(Pt,"src",xt),(!At||1&e[0])&&x(Pt,"background-color",t[0].backgroundColor),(!At||1024&e[0])&&y(St,"width",t[10]),(!At||2048&e[0])&&y(St,"height",t[11]);const n={};4&e[0]&&(n.path=t[2]),Tt.$set(n),(!At||16384&e[0])&&x(wt,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[14]}" viewBox="0 0 ${2*t[14]} ${2*t[14]}" width="${2*t[14]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[14]}" cy="${t[14]}" r="${t[14]}"/></svg>') ${t[14]} ${t[14]}, auto`),(!At||1024&e[0])&&y(It,"width",t[10]),(!At||2048&e[0])&&y(It,"height",t[11]),(!At||1&e[0])&&x(It,"background-color",t[0].backgroundColor)},i(t){At||(N(Tt.$$.fragment,t),At=!0)},o(t){!function(t,e,n,r){if(t&&t.o){if(D.has(t))return;D.add(t),(void 0).c.push((()=>{D.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}(Tt.$$.fragment,t),At=!1},d(n){n&&p(e),Mt.d(),d(jt,n),zt&&zt.d(),t[47](null),t[49](null),z(Tt),t[52](null),Rt=!1,r(Ot)}}}function qt(t,e,n){let r,i,s,o,a,c,l,u,h,p,d=null,f=null,m=0,v=0,g=new It,b=new kt;const y=()=>{g.paths.length>0&&n(2,c=g.paths[0])};y();let P=-1,x=-1,k=10,S=_t.PAINT,_="";const C=()=>""!=_?_:"Animation";let E=(I=document.createElement("a"),document.body.appendChild(I),I.style.display="none",function(t,e){let n=window.URL.createObjectURL(t);I.href=n,I.download=e,I.click(),window.URL.revokeObjectURL(n)});var I;$((async()=>{n(23,o=new Rt(r)),n(1,a=new At(i)),n(1,a.image=s,a)}));let A=0,R=0;document.onkeydown=t=>{if(t.target===document.body&&t.ctrlKey)switch(t.key){case"z":b.undo(),t.preventDefault();break;case"Z":case"y":b.redo(),t.preventDefault();break;case"k":if(null==c)return;c.addKeyframe(A,R,k),t.preventDefault();break;case"p":n(2,c=g.addPath()),n(0,g),t.preventDefault()}};return t.$$.update=()=>{3&t.$$.dirty[0]&&null!=a&&n(1,a.painting=g,a),8388612&t.$$.dirty[0]&&null!=o&&n(23,o.currentPath=c,o),24&t.$$.dirty[0]&&(null!=u&&(URL.revokeObjectURL(u),n(4,u=null)),null!=l&&n(4,u=URL.createObjectURL(l))),32&t.$$.dirty[0]&&null!=h&&createImageBitmap(h).then((t=>n(1,a.doneImage=t,a))),64&t.$$.dirty[0]&&null!=p&&createImageBitmap(p).then((t=>n(1,a.backgroundImage=t,a)))},[g,a,c,l,u,h,p,r,i,s,m,v,P,x,k,S,_,A,R,y,C,E,t=>{let e=r.getBoundingClientRect();n(17,A=t.clientX-e.left),n(18,R=t.clientY-e.top),null!=c&&(0!=t.buttons?(null!=d&&function(t,e,n,r,i){for(var s=Math.abs(t-n),o=Math.abs(e-r),a=n<t?1:-1,c=r<e?1:-1,l=s-o;i(n,r),!(Math.abs(n-t)<1e-4&&Math.abs(r-e)<1e-4);){var u=2*l;u>-o&&(l-=o,n+=a),u<s&&(l+=s,r+=c)}}(d,f,A,R,((t,e)=>S==_t.ERASE?c.eraseRadius(t,e,k):c.addPoint(t,e,k))),d=A,f=R):(null!=d&&b.pushState(c.finishTransaction()),c.strokeDone(),d=null))},o,function(){_=this.value,n(16,_)},()=>{a.prepare(),n(13,x=-1);const t=()=>n(12,P=window.requestAnimationFrame((async e=>{-1!=x?a.drawNextFrame((e-x)/1e3)?t():n(12,P=-1):(n(13,x=e),t()),n(13,x=e)})));t()},()=>{window.cancelAnimationFrame(P),n(12,P=-1)},()=>{Tt((t=>{!g.clean&&confirm("Are you sure you have saved?")&&(n(0,g=new It),y()),n(3,l=t)}))},()=>{Tt((t=>{n(5,h=t)}))},()=>{Tt((t=>{n(6,p=t)}))},()=>{var t=JSON.stringify(g.flatten()),e=new Blob([t],{type:"octet/stream"});E(e,C())},()=>{(g.clean||confirm("Are you sure you have saved?"))&&function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{var n=new FileReader;n.onload=function(){document.body.removeChild(e),t(JSON.parse(n.result.toString()),e.files[0].name)},n.readAsText(e.files[0])}))}(((t,e)=>{n(0,g=It.restore(t)),n(16,_=e),y()}))},()=>{confirm("Are you sure you have saved?")&&(n(0,g=new It),y())},()=>{n(15,S=_t.PAINT)},()=>{n(15,S=_t.ERASE)},()=>{n(15,S=_t.SELECT)},async()=>{const t=new zt(i,60);for(a.prepare();a.drawNextFrame(1/60);)await t.recordFrame();const e=await t.export();E(e,`${C()}.webm`)},t=>{const e=t.currentTarget.value;n(2,c="-1"==e?null:"-2"==e?g.addPath():g.paths.find((t=>t.id==parseInt(e)))),n(0,g)},function(){c.name=this.value,n(2,c),n(0,g)},()=>n(0,g),function(){c.pointsPerSecond=w(this.value),n(2,c),n(0,g)},function(){c.delay=w(this.value),n(2,c),n(0,g)},function(){c.perfectRendering=this.checked,n(2,c),n(0,g)},()=>{g.paths.splice(g.paths.indexOf(c),1),n(2,c=null),n(0,g)},function(){g.backgroundColor=this.value,n(0,g)},function(){g.desiredTime=w(this.value),n(0,g)},function(){g.fadeTime=w(this.value),n(0,g)},function(t){T[t?"unshift":"push"]((()=>{s=t,n(9,s)}))},()=>{n(10,m=s.width),n(11,v=s.height)},function(t){T[t?"unshift":"push"]((()=>{r=t,n(7,r)}))},t=>{let e=r.getBoundingClientRect();n(17,A=t.clientX-e.left),n(18,R=t.clientY-e.top),S!=_t.SELECT||n(2,c=g.findPathAtPoint(A,R))},t=>{n(14,k+=t.deltaY>0?-1:1),t.preventDefault()},function(t){T[t?"unshift":"push"]((()=>{i=t,n(8,i)}))}]}return new class extends X{constructor(t){super(),B(this,t,qt,Kt,s,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
