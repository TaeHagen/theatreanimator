var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function s(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let o,a;function c(t,e){return o||(o=document.createElement("a")),o.href=e,t===o.href}function l(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function p(t){t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function d(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function m(){return v(" ")}function y(){return v("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t){return""===t?null:+t}function P(t,e){t.value=null==e?"":e}function x(t,e,n,r){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function _(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function $(t){a=t}function S(t){(function(){if(!a)throw new Error("Function called outside component initialization");return a})().$$.on_mount.push(t)}const k=[],T=[],E=[],C=[],O=Promise.resolve();let M=!1;function A(t){E.push(t)}const F=new Set;let L=0;function j(){const t=a;do{for(;L<k.length;){const t=k[L];L++,$(t),D(t.$$)}for($(null),k.length=0,L=0;T.length;)T.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];F.has(e)||(F.add(e),e())}E.length=0}while(k.length);for(;C.length;)C.pop()();M=!1,F.clear(),$(t)}function D(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const R=new Set;function z(t,e){t&&t.i&&(R.delete(t),t.i(e))}function N(t,n,i,o){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=t.$$;a&&a.m(n,i),o||A((()=>{const n=c.map(e).filter(s);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(A)}function I(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Y(t,e){-1===t.$$.dirty[0]&&(k.push(t),M||(M=!0,O.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function B(e,s,i,o,c,l,u,h=[-1]){const f=a;$(e);const d=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(f?f.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:s.target||f.$$.root};u&&u(d.root);let v=!1;if(d.ctx=i?i(e,s.props||{},((t,n,...r)=>{const s=r.length?r[0]:n;return d.ctx&&c(d.ctx[t],d.ctx[t]=s)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](s),v&&Y(e,t)),n})):[],d.update(),v=!0,r(d.before_update),d.fragment=!!o&&o(d.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);d.fragment&&d.fragment.l(t),t.forEach(p)}else d.fragment&&d.fragment.c();s.intro&&z(e.$$.fragment),N(e,s.target,s.anchor,s.customElement),j()}$(f)}class U{$destroy(){I(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var X=function(t,e){return X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},X(t,e)};function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}X(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function K(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function q(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}function J(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))}function V(t){return"function"==typeof t}function Z(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var G=Z((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function Q(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var W=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var t,e,n,r,s;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var o=K(i),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else i.remove(this);var c=this.initialTeardown;if(V(c))try{c()}catch(t){s=t instanceof G?t.errors:[t]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=K(l),h=u.next();!h.done;h=u.next()){var p=h.value;try{nt(p)}catch(t){s=null!=s?s:[],t instanceof G?s=J(J([],q(s)),q(t.errors)):s.push(t)}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(s)throw new G(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nt(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Q(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&Q(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),tt=W.EMPTY;function et(t){return t instanceof W||t&&"closed"in t&&V(t.remove)&&V(t.add)&&V(t.unsubscribe)}function nt(t){V(t)?t():t.unsubscribe()}var rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},st={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var s=st.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,J([t,e],q(n))):setTimeout.apply(void 0,J([t,e],q(n)))},clearTimeout:function(t){var e=st.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function it(){}var ot=null;function at(t){if(rt.useDeprecatedSynchronousErrorHandling){var e=!ot;if(e&&(ot={errorThrown:!1,error:null}),t(),e){var n=ot,r=n.errorThrown,s=n.error;if(ot=null,r)throw s}}else t()}var ct=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,et(e)&&e.add(n)):n.destination=dt,n}return H(e,t),e.create=function(t,e,n){return new pt(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(W),lt=Function.prototype.bind;function ut(t,e){return lt.call(t,e)}var ht=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){ft(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){ft(t)}else ft(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){ft(t)}},t}(),pt=function(t){function e(e,n,r){var s,i,o=t.call(this)||this;V(e)||!e?s={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&rt.useDeprecatedNextContext?((i=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},s={next:e.next&&ut(e.next,i),error:e.error&&ut(e.error,i),complete:e.complete&&ut(e.complete,i)}):s=e;return o.destination=new ht(s),o}return H(e,t),e}(ct);function ft(t){var e;e=t,st.setTimeout((function(){throw e}))}var dt={closed:!0,next:it,error:function(t){throw t},complete:it},vt="function"==typeof Symbol&&Symbol.observable||"@@observable";function mt(t){return t}function yt(t){return 0===t.length?mt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var bt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,s=this,i=(r=t)&&r instanceof ct||function(t){return t&&V(t.next)&&V(t.error)&&V(t.complete)}(r)&&et(r)?t:new pt(t,e,n);return at((function(){var t=s,e=t.operator,n=t.source;i.add(e?e.call(i,n):n?s._subscribe(i):s._trySubscribe(i))})),i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=gt(e))((function(e,r){var s=new pt({next:function(e){try{t(e)}catch(t){r(t),s.unsubscribe()}},error:r,complete:e});n.subscribe(s)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[vt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yt(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=gt(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function gt(t){var e;return null!==(e=null!=t?t:rt.Promise)&&void 0!==e?e:Promise}var wt=Z((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Pt=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return H(e,t),e.prototype.lift=function(t){var e=new xt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new wt},e.prototype.next=function(t){var e=this;at((function(){var n,r;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var s=K(e.currentObservers),i=s.next();!i.done;i=s.next()){i.value.next(t)}}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;at((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;at((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=this,r=n.hasError,s=n.isStopped,i=n.observers;return r||s?tt:(this.currentObservers=null,i.push(t),new W((function(){e.currentObservers=null,Q(i,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,r=e.thrownError,s=e.isStopped;n?t.error(r):s&&t.complete()},e.prototype.asObservable=function(){var t=new bt;return t.source=this,t},e.create=function(t,e){return new xt(t,e)},e}(bt),xt=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return H(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:tt},e}(Pt);class _t{constructor(){this.states=[],this.pointer=-1}pushState(t){this.pointer!==this.states.length-1&&this.states.splice(this.pointer+1),this.states.push(t),this.pointer++}undo(){this.pointer<0||(this.states[this.pointer].undo(),this.pointer--)}redo(){this.pointer+1!==this.states.length&&(this.states[this.pointer+1].redo(),this.pointer++)}}const $t={createPoint:(t,e,n,r)=>[t,e,n,r],parsePointX:t=>t[0],parsePointY:t=>t[1],parsePointTime:t=>t[2],parseBrushSize:t=>t[3],flatten:t=>({x:$t.parsePointX(t),y:$t.parsePointY(t),time:$t.parsePointTime(t),brushSize:$t.parseBrushSize(t)}),restore:t=>$t.createPoint(t.x,t.y,t.time,t.brushSize)};class St{constructor(t){this.point=t,this.speed=500}flatten(){return{point:$t.flatten(this.point),speed:this.speed}}static restore(t){const e=new St($t.restore(t.point));return e.speed=t.speed,e}apply(t){t.effectivePointsPerSeconds=this.speed}}let kt=0;class Tt{constructor(){this.id=kt++,this.name="New Path",this.points=[],this.transaction=[],this.eraseTransaction=[],this.keyframes=[],this.pointsPerSecond=250,this.effectivePointsPerSeconds=this.pointsPerSecond,this.delay=0,this.lastPoint=null,this.newPoint$=new Pt,this.newKeyframe$=new Pt,this.changed$=new Pt}get clean(){return 0==this.points.length&&0==this.keyframes.length}findDist(t,e,n,r){return Math.sqrt(Math.abs(e-t)**2+Math.abs(r-n)**2)}applyKeyframesForPoint(t){this.effectivePointsPerSeconds=this.pointsPerSecond,this.keyframes.filter((e=>$t.parsePointTime(e.point)<=t)).map((t=>t.apply(this)))}flatten(){return{points:this.points.map((t=>$t.flatten(t))),keyframes:this.keyframes.map((t=>t.flatten())),pointsPerSecond:this.pointsPerSecond,name:this.name,id:this.id,delay:this.delay}}static restore(t){const e=new Tt;return e.points=t.points.map((t=>$t.restore(t))),e.keyframes=t.keyframes.map((t=>St.restore(t))),e.pointsPerSecond=t.pointsPerSecond,e.name=t.name,e.id=t.id,e.delay=t.delay,e}findClosestPoint(t,e){if(0==this.points.length)return null;let n,r,s,i=this.points[0];const o=()=>{n=$t.parsePointX(i),r=$t.parsePointY(i),s=this.findDist(n,t,r,e)};o();for(const n of this.points){const r=$t.parsePointX(n),a=$t.parsePointY(n);this.findDist(r,t,a,e)<s&&(i=n,o())}return i}addPoint(t,e,n){if(this.lastPoint=this.findClosestPoint(t,e),null!=this.lastPoint){const n=$t.parsePointX(this.lastPoint),r=$t.parsePointY(this.lastPoint);if(n==t&&r==e)return}const r=$t.createPoint(t,e,null!=this.lastPoint?$t.parsePointTime(this.lastPoint)+1:0,n);this.points.push(r),this.transaction.push(r),this.lastPoint=r,this.newPoint$.next(r)}eraseRadius(t,e,n){this.points=this.points.filter((r=>{const s=this.findDist(t,$t.parsePointX(r),e,$t.parsePointY(r))>n;return s||this.eraseTransaction.push(r),s})),this.changed$.next()}addKeyframe(t,e,n){var r;const s=new St($t.createPoint(t,e,null!==(r=$t.parsePointTime(this.findClosestPoint(t,e))+1)&&void 0!==r?r:0,n));this.keyframes.push(s),this.newKeyframe$.next(s)}finishTransaction(){const t=this.transaction,e=this.eraseTransaction;return this.transaction=[],this.eraseTransaction=[],{name:"Add stroke",undo:()=>{this.points=this.points.filter((e=>!t.includes(e))).concat(e),this.changed$.next()},redo:()=>{this.points=this.points.concat(t).filter((t=>!e.includes(t))),this.changed$.next()}}}strokeDone(){this.lastPoint=null}}class Et{constructor(){this.paths=[new Tt]}addPath(){const t=new Tt;return this.paths.push(t),t}flatten(){return{paths:this.paths.map((t=>t.flatten()))}}get clean(){return this.paths.every((t=>t.clean))}static restore(t){const e=new Et;return e.paths=t.paths.map((t=>Tt.restore(t))),e}}class Ct{constructor(t){this.canvas=t,this.totalPoints=0,this.pathProgress=new Map,this.pathPoints=new Map,this.secSinceStart=0,this.ctx=t.getContext("2d")}allDrawn(){for(const t of this.pathPoints.values())if(t.length>0)return!1;return!0}drawNextFrame(t){this.secSinceStart+=t;const e=this.pointsForPaths(t);if(this.allDrawn())return!1;for(const t of e){this.ctx.save(),this.ctx.beginPath();for(const e of t)this.drawPoint(e);this.ctx.clip(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.image,0,0),this.ctx.restore()}return!0}pointsForPaths(t){return this.painting.paths.map((e=>{var n,r;if(this.secSinceStart<e.delay/1e3)return null;let s=null!==(n=this.pathProgress.get(e))&&void 0!==n?n:0;s+=t*e.effectivePointsPerSeconds,this.pathProgress.set(e,s),e.applyKeyframesForPoint(s);let i=null!==(r=this.pathPoints.get(e))&&void 0!==r?r:e.points,o=[];return i=i.filter((t=>{const e=$t.parsePointTime(t)<=s;return e&&o.push(t),!e})),this.pathPoints.set(e,i),o})).filter((t=>null!=t))}prepare(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.totalPoints=this.painting.paths.reduce(((t,e)=>t+e.points.length),0),this.pathProgress.clear(),this.secSinceStart=0,this.pathProgress.clear();for(const t of this.painting.paths)this.pathPoints.set(t,t.points)}drawPoint(t){this.ctx.arc($t.parsePointX(t),$t.parsePointY(t),$t.parseBrushSize(t),0,2*Math.PI)}}class Ot{constructor(t){this.canvas=t,this.currentPathSubscriptions=[],this.ctx=t.getContext("2d")}set currentPath(t){this._currentPath=t,this.currentPathSubscriptions.forEach((t=>t.unsubscribe())),this.redrawPath(),null!=t&&(this.currentPathSubscriptions.push(t.newPoint$.subscribe((t=>this.drawPoint(t)))),this.currentPathSubscriptions.push(t.changed$.subscribe((()=>this.redrawPath()))))}get currentPath(){return this._currentPath}redrawPath(){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),null!=this.currentPath)for(const t of this.currentPath.points)this.drawPoint(t)}drawPoint(t){const e=function(t,e,n){var r,s,i,o,a,c,l,u;switch(1===arguments.length&&(e=t.s,n=t.v,t=t.h),c=n*(1-e),l=n*(1-(a=6*t-(o=Math.floor(6*t)))*e),u=n*(1-(1-a)*e),o%6){case 0:r=n,s=u,i=c;break;case 1:r=l,s=n,i=c;break;case 2:r=c,s=n,i=u;break;case 3:r=c,s=l,i=n;break;case 4:r=u,s=c,i=n;break;case 5:r=n,s=c,i=l}return{r:Math.round(255*r),g:Math.round(255*s),b:Math.round(255*i)}}($t.parsePointTime(t)/1e3,1,1);this.ctx.fillStyle=`rgba(${e.r}, ${e.g}, ${e.b}, 255)`,this.ctx.beginPath(),this.ctx.arc($t.parsePointX(t),$t.parsePointY(t),$t.parseBrushSize(t),0,2*Math.PI,!1),this.ctx.fill()}}function Mt(t,e,n){const r=t.slice();return r[4]=e[n],r}function At(t){let e,n=t[0].keyframes,r=[];for(let e=0;e<n.length;e+=1)r[e]=Ft(Mt(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=y()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);h(t,e,n)},p(t,s){if(3&s){let i;for(n=t[0].keyframes,i=0;i<n.length;i+=1){const o=Mt(t,n,i);r[i]?r[i].p(o,s):(r[i]=Ft(o),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(t){f(r,t),t&&p(e)}}}function Ft(t){let e,n,r;function s(){return t[3](t[4])}return{c(){e=d("span"),g(e,"class","keyframe svelte-cpouo2"),x(e,"top",$t.parsePointY(t[4].point)-5+"px"),x(e,"left",$t.parsePointX(t[4].point)-5+"px")},m(t,i){h(t,e,i),n||(r=b(e,"click",s),n=!0)},p(n,r){t=n,1&r&&x(e,"top",$t.parsePointY(t[4].point)-5+"px"),1&r&&x(e,"left",$t.parsePointX(t[4].point)-5+"px")},d(t){t&&p(e),n=!1,r()}}}function Lt(e){let n,r=null!=e[0]&&At(e);return{c(){r&&r.c(),n=y()},m(t,e){r&&r.m(t,e),h(t,n,e)},p(t,[e]){null!=t[0]?r?r.p(t,e):(r=At(t),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:t,o:t,d(t){r&&r.d(t),t&&p(n)}}}function jt(t,e,n){let{path:r}=e,s=[];const i=t=>{t.speed=parseInt(prompt("New speed",t.speed.toString()))};return t.$$set=t=>{"path"in t&&n(0,r=t.path)},t.$$.update=()=>{5&t.$$.dirty&&(s.forEach((t=>t.unsubscribe())),n(2,s=[]),null!=r&&(s.push(r.newKeyframe$.subscribe((t=>{n(0,r),n(2,s),i(t)}))),s.push(r.changed$.subscribe((t=>{n(0,r),n(2,s)})))))},[r,i,s,t=>{i(t)}]}class Dt extends U{constructor(t){super(),B(this,t,jt,Lt,i,{path:0})}}function Rt(t,e){return new Promise((n=>t.addEventListener(e,n,{once:!0})))}class zt{constructor(t,e=30){this.FPS=e,this.source=t;const n=this.canvas=t.cloneNode();(this.drawingContext=n.getContext("2d")).drawImage(t,0,0);const r=this.stream=n.captureStream(0),s=this.track=r.getVideoTracks()[0];s.requestFrame||(s.requestFrame=()=>r.requestFrame());const i=this.recorder=new MediaRecorder(r),o=this.chunks=[];i.ondataavailable=t=>o.push(t.data),i.start(),Rt(i,"start").then((t=>i.pause())),this._init=Rt(i,"pause")}async recordFrame(){await this._init;const t=this.recorder,e=this.canvas,n=this.source,r=this.drawingContext;e.width===n.width&&e.height===n.height||(e.width=n.width,e.height=n.height);const s=(i=1e3/this.FPS,new Promise((t=>setTimeout(t,i))));var i;t.resume(),await Rt(t,"resume"),r.clearRect(0,0,e.width,e.height),r.drawImage(n,0,0),this.track.requestFrame(),await s,t.pause(),await Rt(t,"pause")}async export(){return this.recorder.stop(),this.stream.getTracks().forEach((t=>t.stop())),await Rt(this.recorder,"stop"),new Blob(this.chunks,{type:"video/mp4"})}}function Nt(t,e,n){const r=t.slice();return r[47]=e[n],r}function It(e){let n,r,s;return{c(){n=d("button"),n.innerHTML='<span class="material-icons">stop</span>',g(n,"class","svelte-u61lso")},m(t,i){h(t,n,i),r||(s=b(n,"click",e[22]),r=!0)},p:t,d(t){t&&p(n),r=!1,s()}}}function Yt(e){let n,r,s;return{c(){n=d("button"),n.innerHTML='<span class="material-icons">play_arrow</span>',g(n,"class","svelte-u61lso")},m(t,i){h(t,n,i),r||(s=b(n,"click",e[21]),r=!0)},p:t,d(t){t&&p(n),r=!1,s()}}}function Bt(t){let e,n,r,s,i=t[47].name+"";return{c(){e=d("option"),n=v(i),r=m(),e.__value=s=t[47].id,e.value=e.__value},m(t,s){h(t,e,s),u(e,n),u(e,r)},p(t,r){1&r[0]&&i!==(i=t[47].name+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,i),1&r[0]&&s!==(s=t[47].id)&&(e.__value=s,e.value=e.__value)},d(t){t&&p(e)}}}function Ut(t){let e,n,s,i,o,a,c,l,u,f,v,y,_,$,S,k;return{c(){e=d("span"),e.textContent="Path name",n=m(),s=d("input"),i=m(),o=d("span"),o.textContent="Speed",a=m(),c=d("input"),l=m(),u=d("span"),u.textContent="Start delay (ms)",f=m(),v=d("input"),y=d("br"),_=m(),$=d("button"),$.textContent="Delete path",g(e,"class","miniheader svelte-u61lso"),g(s,"type","text"),g(s,"class","svelte-u61lso"),g(o,"class","miniheader svelte-u61lso"),g(c,"type","range"),g(c,"min","1"),g(c,"max","1500"),g(c,"class","svelte-u61lso"),g(u,"class","miniheader svelte-u61lso"),g(v,"type","number"),g(v,"class","svelte-u61lso"),x($,"background-color","#e53e3e"),x($,"margin-top","15px"),g($,"class","svelte-u61lso")},m(r,p){h(r,e,p),h(r,n,p),h(r,s,p),P(s,t[2].name),h(r,i,p),h(r,o,p),h(r,a,p),h(r,c,p),P(c,t[2].pointsPerSecond),h(r,l,p),h(r,u,p),h(r,f,p),h(r,v,p),P(v,t[2].delay),h(r,y,p),h(r,_,p),h(r,$,p),S||(k=[b(s,"input",t[31]),b(s,"change",t[32]),b(c,"change",t[33]),b(c,"input",t[33]),b(v,"input",t[34]),b($,"click",t[35])],S=!0)},p(t,e){5&e[0]&&s.value!==t[2].name&&P(s,t[2].name),5&e[0]&&P(c,t[2].pointsPerSecond),5&e[0]&&w(v.value)!==t[2].delay&&P(v,t[2].delay)},d(t){t&&p(e),t&&p(n),t&&p(s),t&&p(i),t&&p(o),t&&p(a),t&&p(c),t&&p(l),t&&p(u),t&&p(f),t&&p(v),t&&p(y),t&&p(_),t&&p($),S=!1,r(k)}}}function Xt(t){let e,n,s,i,o,a,v,y,w,$,S,k,T,E,C,O,M,A,F,L,j,D,Y,B,U,X,H,K,q,J,V,Z,G,Q,W,tt,et,nt,rt,st,it,ot,at,ct,lt,ut,ht,pt,ft,dt,vt;function mt(t,e){return-1==t[10]?Yt:It}let yt=mt(t),bt=yt(t),gt=t[0].paths,wt=[];for(let e=0;e<gt.length;e+=1)wt[e]=Bt(Nt(t,gt,e));let Pt=null!=t[2]&&Ut(t);return lt=new Dt({props:{path:t[2]}}),{c(){e=d("main"),n=d("div"),s=d("div"),i=d("input"),o=m(),a=d("div"),bt.c(),v=m(),y=d("button"),y.innerHTML='<span class="material-icons">image</span>',w=m(),$=d("button"),$.innerHTML='<span class="material-icons">download</span>',S=m(),k=d("button"),k.innerHTML='<span class="material-icons">upload</span>',T=m(),E=d("button"),E.innerHTML='<span class="material-icons">layers_clear</span>',C=m(),O=d("button"),M=d("span"),M.textContent="brush",F=m(),L=d("button"),j=d("span"),j.textContent="clear",Y=m(),B=d("button"),B.innerHTML='<span class="material-icons">movie</span>',U=m(),X=d("div"),H=d("select");for(let t=0;t<wt.length;t+=1)wt[t].c();var r;K=d("option"),q=d("option"),q.textContent="Add Path",V=m(),Pt&&Pt.c(),Z=m(),G=d("div"),Q=d("span"),Q.textContent="Brush size",W=m(),tt=d("input"),et=m(),nt=d("div"),rt=d("div"),st=d("img"),ot=m(),at=d("canvas"),ct=m(),(r=lt.$$.fragment)&&r.c(),ut=m(),ht=d("div"),pt=d("canvas"),g(i,"type","text"),g(i,"placeholder","Project Name"),g(i,"class","svelte-u61lso"),g(y,"title","Open image"),g(y,"class","svelte-u61lso"),g($,"class","svelte-u61lso"),g(k,"class","svelte-u61lso"),g(E,"title","Clear all layers"),g(E,"class","svelte-u61lso"),g(M,"class","material-icons"),g(O,"class",A=l(t[13]?"":"selected")+" svelte-u61lso"),g(j,"class","material-icons"),g(L,"title","Erase"),g(L,"class",D=l(t[13]?"selected":"")+" svelte-u61lso"),g(B,"title","Render"),g(B,"class","svelte-u61lso"),g(a,"class","topbar svelte-u61lso"),K.__value=-1,K.value=K.__value,q.__value=-2,q.value=q.__value,g(H,"class","svelte-u61lso"),x(X,"text-align","right"),g(s,"class","sidebartop svelte-u61lso"),g(Q,"class","miniheader svelte-u61lso"),g(tt,"type","range"),g(tt,"min","1"),g(tt,"max","20"),g(tt,"class","svelte-u61lso"),g(G,"class","footer"),g(n,"class","sidebar svelte-u61lso"),c(st.src,it=t[4])||g(st,"src",it),g(st,"class","svelte-u61lso"),g(at,"width",t[8]),g(at,"height",t[9]),g(at,"class","svelte-u61lso"),g(rt,"class","overlay image svelte-u61lso"),x(rt,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[12]}" viewBox="0 0 ${2*t[12]} ${2*t[12]}" width="${2*t[12]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[12]}" cy="${t[12]}" r="${t[12]}"/></svg>') ${t[12]} ${t[12]}, auto`),g(pt,"width",t[8]),g(pt,"height",t[9]),g(pt,"class","svelte-u61lso"),g(ht,"class","image svelte-u61lso"),g(nt,"class","imagesContainer svelte-u61lso"),g(e,"class","svelte-u61lso")},m(r,c){h(r,e,c),u(e,n),u(n,s),u(s,i),P(i,t[14]),u(s,o),u(s,a),bt.m(a,null),u(a,v),u(a,y),u(a,w),u(a,$),u(a,S),u(a,k),u(a,T),u(a,E),u(a,C),u(a,O),u(O,M),u(a,F),u(a,L),u(L,j),u(a,Y),u(a,B),u(s,U),u(s,X),u(X,H);for(let t=0;t<wt.length;t+=1)wt[t].m(H,null);u(H,K),u(H,q),_(H,t[2]?.id??-1),u(s,V),Pt&&Pt.m(s,null),u(n,Z),u(n,G),u(G,Q),u(G,W),u(G,tt),P(tt,t[12]),u(e,et),u(e,nt),u(nt,rt),u(rt,st),t[37](st),u(rt,ot),u(rt,at),t[39](at),u(rt,ct),N(lt,rt,null),u(nt,ut),u(nt,ht),u(ht,pt),t[41](pt),ft=!0,dt||(vt=[b(i,"input",t[20]),b(y,"click",t[23]),b($,"click",t[24]),b(k,"click",t[25]),b(E,"click",t[26]),b(O,"click",t[27]),b(L,"click",t[28]),b(B,"click",t[29]),b(H,"change",t[30]),b(tt,"change",t[36]),b(tt,"input",t[36]),b(st,"load",t[38]),b(at,"mousemove",t[18]),b(at,"wheel",t[40])],dt=!0)},p(t,e){if(16384&e[0]&&i.value!==t[14]&&P(i,t[14]),yt===(yt=mt(t))&&bt?bt.p(t,e):(bt.d(1),bt=yt(t),bt&&(bt.c(),bt.m(a,v))),(!ft||8192&e[0]&&A!==(A=l(t[13]?"":"selected")+" svelte-u61lso"))&&g(O,"class",A),(!ft||8192&e[0]&&D!==(D=l(t[13]?"selected":"")+" svelte-u61lso"))&&g(L,"class",D),1&e[0]){let n;for(gt=t[0].paths,n=0;n<gt.length;n+=1){const r=Nt(t,gt,n);wt[n]?wt[n].p(r,e):(wt[n]=Bt(r),wt[n].c(),wt[n].m(H,K))}for(;n<wt.length;n+=1)wt[n].d(1);wt.length=gt.length}(!ft||5&e[0]&&J!==(J=t[2]?.id??-1))&&_(H,t[2]?.id??-1),null!=t[2]?Pt?Pt.p(t,e):(Pt=Ut(t),Pt.c(),Pt.m(s,null)):Pt&&(Pt.d(1),Pt=null),4096&e[0]&&P(tt,t[12]),(!ft||16&e[0]&&!c(st.src,it=t[4]))&&g(st,"src",it),(!ft||256&e[0])&&g(at,"width",t[8]),(!ft||512&e[0])&&g(at,"height",t[9]);const n={};4&e[0]&&(n.path=t[2]),lt.$set(n),(!ft||4096&e[0])&&x(rt,"cursor",`url('data:image/svg+xml;utf8,<svg stroke="%23000000" fill="transparent" height="${2*t[12]}" viewBox="0 0 ${2*t[12]} ${2*t[12]}" width="${2*t[12]}" xmlns="http://www.w3.org/2000/svg"><circle cx="${t[12]}" cy="${t[12]}" r="${t[12]}"/></svg>') ${t[12]} ${t[12]}, auto`),(!ft||256&e[0])&&g(pt,"width",t[8]),(!ft||512&e[0])&&g(pt,"height",t[9])},i(t){ft||(z(lt.$$.fragment,t),ft=!0)},o(t){!function(t,e,n,r){if(t&&t.o){if(R.has(t))return;R.add(t),(void 0).c.push((()=>{R.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}(lt.$$.fragment,t),ft=!1},d(n){n&&p(e),bt.d(),f(wt,n),Pt&&Pt.d(),t[37](null),t[39](null),I(lt),t[41](null),dt=!1,r(vt)}}}function Ht(t,e,n){let r,s,i,o,a,c,l,u,h=null,p=null,f=0,d=0,v=new Et,m=new _t;const y=()=>{v.paths.length>0&&n(2,c=v.paths[0])};y();let b=-1,g=-1,P=10,x=!1,_="";const $=()=>""!=_?_:"Animation";let k=(E=document.createElement("a"),document.body.appendChild(E),E.style.display="none",function(t,e){let n=window.URL.createObjectURL(t);E.href=n,E.download=e,E.click(),window.URL.revokeObjectURL(n)});var E;S((async()=>{n(19,o=new Ot(r)),n(1,a=new Ct(s)),n(1,a.image=i,a)}));let C=0,O=0;document.onkeydown=t=>{if(t.target===document.body&&t.ctrlKey)switch(t.key){case"z":m.undo(),t.preventDefault();break;case"Z":case"y":m.redo(),t.preventDefault();break;case"k":if(null==c)return;c.addKeyframe(C,O,P),t.preventDefault();break;case"p":n(2,c=v.addPath()),n(0,v),t.preventDefault()}};return t.$$.update=()=>{3&t.$$.dirty[0]&&null!=a&&n(1,a.painting=v,a),524292&t.$$.dirty[0]&&null!=o&&n(19,o.currentPath=c,o),24&t.$$.dirty[0]&&(null!=u&&(URL.revokeObjectURL(u),n(4,u=null)),null!=l&&n(4,u=URL.createObjectURL(l)))},[v,a,c,l,u,r,s,i,f,d,b,g,P,x,_,y,$,k,t=>{if(null==c)return;let e=r.getBoundingClientRect();C=t.clientX-e.left,O=t.clientY-e.top,0!=t.buttons?(null!=h&&function(t,e,n,r,s){for(var i=Math.abs(t-n),o=Math.abs(e-r),a=n<t?1:-1,c=r<e?1:-1,l=i-o;s(n,r),!(Math.abs(n-t)<1e-4&&Math.abs(r-e)<1e-4);){var u=2*l;u>-o&&(l-=o,n+=a),u<i&&(l+=i,r+=c)}}(h,p,C,O,((t,e)=>x?c.eraseRadius(t,e,P):c.addPoint(t,e,P))),h=C,p=O):(null!=h&&m.pushState(c.finishTransaction()),c.strokeDone(),h=null)},o,function(){_=this.value,n(14,_)},()=>{a.prepare(),n(11,g=-1);const t=()=>n(10,b=window.requestAnimationFrame((e=>{-1!=g?a.drawNextFrame((e-g)/1e3)?t():n(10,b=-1):(n(11,g=e),t()),n(11,g=e)})));t()},()=>{window.cancelAnimationFrame(b),n(10,b=-1)},()=>{!function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{t(e.files[0])}))}((t=>{!v.clean&&confirm("Are you sure you have saved?")&&(n(0,v=new Et),y()),n(3,l=t)}))},()=>{var t=JSON.stringify(v.flatten()),e=new Blob([t],{type:"octet/stream"});k(e,$())},()=>{(v.clean||confirm("Are you sure you have saved?"))&&function(t){const e=document.createElement("input");e.style.display="none",e.type="file",document.body.appendChild(e),e.click(),e.addEventListener("change",(()=>{var n=new FileReader;n.onload=function(){document.body.removeChild(e),t(JSON.parse(n.result.toString()),e.files[0].name)},n.readAsText(e.files[0])}))}(((t,e)=>{n(0,v=Et.restore(t)),n(14,_=e),y()}))},()=>{confirm("Are you sure you have saved?")&&(n(0,v=new Et),y())},()=>{n(13,x=!1)},()=>{n(13,x=!0)},async()=>{const t=new zt(s,60);for(a.prepare();a.drawNextFrame(1/60);)await t.recordFrame();const e=await t.export();k(e,`${$()}.webm`)},t=>{const e=t.currentTarget.value;n(2,c="-1"==e?null:"-2"==e?v.addPath():v.paths.find((t=>t.id==parseInt(e)))),n(0,v)},function(){c.name=this.value,n(2,c),n(0,v)},()=>n(0,v),function(){c.pointsPerSecond=w(this.value),n(2,c),n(0,v)},function(){c.delay=w(this.value),n(2,c),n(0,v)},()=>{v.paths.splice(v.paths.indexOf(c),1),n(2,c=null),n(0,v)},function(){P=w(this.value),n(12,P)},function(t){T[t?"unshift":"push"]((()=>{i=t,n(7,i)}))},()=>{n(8,f=i.width),n(9,d=i.height)},function(t){T[t?"unshift":"push"]((()=>{r=t,n(5,r)}))},t=>{n(12,P+=t.deltaY>0?-1:1),t.preventDefault()},function(t){T[t?"unshift":"push"]((()=>{s=t,n(6,s)}))}]}return new class extends U{constructor(t){super(),B(this,t,Ht,Xt,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
